(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[15],{

/***/ "./js/modules/exporter/docx/citations.js":
/*!***********************************************!*\
  !*** ./js/modules/exporter/docx/citations.js ***!
  \***********************************************/
/*! exports provided: DocxExporterCitations */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DocxExporterCitations\", function() { return DocxExporterCitations; });\n/* harmony import */ var prosemirror_model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! prosemirror-model */ \"./node_modules/prosemirror-model/dist/index.js\");\n/* harmony import */ var prosemirror_model__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _citations_format__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../citations/format */ \"./js/modules/citations/format.js\");\n/* harmony import */ var _schema_footnotes__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../schema/footnotes */ \"./js/modules/schema/footnotes.js\");\n/* harmony import */ var _bibliography_schema_csl_bib__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../bibliography/schema/csl_bib */ \"./js/modules/bibliography/schema/csl_bib.js\");\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n            <w:style w:type=\\\"paragraph\\\" w:styleId=\\\"Bibliography1\\\">\\n                <w:name w:val=\\\"Bibliography 1\\\"/>\\n                <w:basedOn w:val=\\\"Normal\\\"/>\\n                <w:qFormat/>\\n                <w:pPr>\\n                    \", \"\\n                    <w:spacing w:lineRule=\\\"atLeast\\\" w:line=\\\"\", \"\\\" w:before=\\\"0\\\" w:after=\\\"\", \"\\\"/>\\n                    <w:ind w:left=\\\"\", \"\\\" w:hanging=\\\"\", \"\\\"/>\\n                </w:pPr>\\n                <w:rPr></w:rPr>\\n            </w:style>\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n                <w:style w:type=\\\"paragraph\\\" w:styleId=\\\"BibliographyHeading\\\">\\n                    <w:name w:val=\\\"Bibliography Heading\\\"/>\\n                    <w:basedOn w:val=\\\"Heading\\\"/>\\n                    <w:pPr>\\n                        <w:suppressLineNumbers/>\\n                        <w:ind w:left=\\\"0\\\" w:hanging=\\\"0\\\"/>\\n                    </w:pPr>\\n                    <w:rPr>\\n                        <w:b/>\\n                        <w:bCs/>\\n                        <w:sz w:val=\\\"32\\\"/>\\n                        <w:szCs w:val=\\\"32\\\"/>\\n                    </w:rPr>\\n                </w:style>\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\n\nvar DocxExporterCitations =\n/*#__PURE__*/\nfunction () {\n  function DocxExporterCitations(exporter, bibDB, citationStyles, citationLocales, docContents) {\n    var origCitInfos = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : [];\n\n    _classCallCheck(this, DocxExporterCitations);\n\n    this.exporter = exporter;\n    this.bibDB = bibDB;\n    this.citationStyles = citationStyles;\n    this.citationLocales = citationLocales;\n    this.docContents = docContents;\n    this.origCitInfos = origCitInfos;\n    this.citInfos = [];\n    this.citationTexts = [];\n    this.pmCits = [];\n    this.citFm = false;\n    this.pmBib = false;\n    this.styleXml = false;\n    this.styleFilePath = 'word/styles.xml';\n  }\n\n  _createClass(DocxExporterCitations, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.exporter.xml.getXml(this.styleFilePath).then(function (styleXml) {\n        _this.styleXml = styleXml;\n        return Promise.resolve();\n      }).then(function () {\n        return _this.formatCitations();\n      });\n    } // Citations are highly interdependent -- so we need to format them all\n    // together before laying out the document.\n\n  }, {\n    key: \"formatCitations\",\n    value: function formatCitations() {\n      var _this2 = this;\n\n      if (this.origCitInfos.length) {\n        // Initial citInfos are taken from a previous run to include in bibliography,\n        // and they are removed before spitting out the citation entries for the given document.\n        // That way the bibliography should contain information from both.\n        this.citInfos = this.citInfos.concat(this.origCitInfos);\n      }\n\n      Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_4__[\"descendantNodes\"])(this.docContents).forEach(function (node) {\n        if (node.type === 'citation') {\n          _this2.citInfos.push(JSON.parse(JSON.stringify(node.attrs)));\n        }\n      });\n      this.citFm = new _citations_format__WEBPACK_IMPORTED_MODULE_1__[\"FormatCitations\"](this.citInfos, this.exporter.doc.settings.citationstyle, '', this.bibDB, this.citationStyles, this.citationLocales);\n      return this.citFm.init().then(function () {\n        _this2.citationTexts = _this2.citFm.citationTexts;\n\n        if (_this2.origCitInfos.length) {\n          // Remove all citation texts originating from original starting citInfos\n          _this2.citationTexts.splice(0, _this2.origCitInfos.length);\n        }\n\n        _this2.convertCitations();\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"convertCitations\",\n    value: function convertCitations() {\n      // There could be some formatting in the citations, so we parse them through the PM schema for final formatting.\n      // We need to put the citations each in a paragraph so that it works with\n      // the fiduswriter schema and so that the converter doesn't mash them together.\n      var citationsHTML = '';\n      this.citationTexts.forEach(function (ct) {\n        citationsHTML += \"<p>\".concat(ct, \"</p>\");\n      }); // We create a standard body footnotecontainer node, add the citations into it, and parse it back.\n\n      var fnNode = _schema_footnotes__WEBPACK_IMPORTED_MODULE_2__[\"fnSchema\"].nodeFromJSON({\n        type: 'footnotecontainer'\n      });\n      var serializer = prosemirror_model__WEBPACK_IMPORTED_MODULE_0__[\"DOMSerializer\"].fromSchema(_schema_footnotes__WEBPACK_IMPORTED_MODULE_2__[\"fnSchema\"]);\n      var dom = serializer.serializeNode(fnNode);\n      dom.innerHTML = citationsHTML;\n      this.pmCits = prosemirror_model__WEBPACK_IMPORTED_MODULE_0__[\"DOMParser\"].fromSchema(_schema_footnotes__WEBPACK_IMPORTED_MODULE_2__[\"fnSchema\"]).parse(dom, {\n        topNode: fnNode\n      }).toJSON().content; // Now we do the same for the bibliography.\n\n      var cslBib = this.citFm.bibliography;\n\n      if (cslBib[1].length > 0) {\n        this.addReferenceStyle(cslBib[0]);\n        var bibNode = _bibliography_schema_csl_bib__WEBPACK_IMPORTED_MODULE_3__[\"cslBibSchema\"].nodeFromJSON({\n          type: 'cslbib'\n        });\n        var cslSerializer = prosemirror_model__WEBPACK_IMPORTED_MODULE_0__[\"DOMSerializer\"].fromSchema(_bibliography_schema_csl_bib__WEBPACK_IMPORTED_MODULE_3__[\"cslBibSchema\"]);\n        dom = cslSerializer.serializeNode(bibNode);\n        dom.innerHTML = cslBib[1].join('');\n        this.pmBib = prosemirror_model__WEBPACK_IMPORTED_MODULE_0__[\"DOMParser\"].fromSchema(_bibliography_schema_csl_bib__WEBPACK_IMPORTED_MODULE_3__[\"cslBibSchema\"]).parse(dom, {\n          topNode: bibNode\n        }).toJSON();\n      }\n    }\n  }, {\n    key: \"addReferenceStyle\",\n    value: function addReferenceStyle(bibInfo) {\n      var stylesEl = this.styleXml.querySelector('styles');\n\n      if (!this.styleXml.querySelector(\"style[*|styleId=\\\"BibliographyHeading\\\"]\")) {\n        // There is no style definition for the bibliography heading. We have to add it.\n        var headingStyleDef = Object(_common__WEBPACK_IMPORTED_MODULE_5__[\"noSpaceTmp\"])(_templateObject());\n        stylesEl.insertAdjacentHTML('beforeEnd', headingStyleDef);\n      } // The style called \"Bibliography1\" will override any previous style\n      // of the same name.\n\n\n      var stylesParStyle = this.styleXml.querySelector(\"style[*|styleId=\\\"Bibliography1\\\"]\");\n\n      if (stylesParStyle) {\n        stylesParStyle.parentNode.removeChild(stylesParStyle);\n      }\n\n      var lineHeight = 240 * bibInfo.linespacing;\n      var marginBottom = 240 * bibInfo.entryspacing;\n      var marginLeft = 0,\n          hangingIndent = 0,\n          tabStops = '';\n\n      if (bibInfo.hangingindent) {\n        marginLeft = 720;\n        hangingIndent = 720;\n      } else if (bibInfo[\"second-field-align\"]) {\n        // We calculate 120 as roughly equivalent to one letter width.\n        var firstFieldWidth = (bibInfo.maxoffset + 1) * 120;\n\n        if (bibInfo[\"second-field-align\"] === 'margin') {\n          hangingIndent = firstFieldWidth;\n          tabStops = '<w:tabs><w:tab w:val=\"left\" w:pos=\"0\" w:leader=\"none\"/></w:tabs>';\n        } else {\n          hangingIndent = firstFieldWidth;\n          marginLeft = firstFieldWidth;\n          tabStops = \"<w:tabs><w:tab w:val=\\\"left\\\" w:pos=\\\"\".concat(firstFieldWidth, \"\\\" w:leader=\\\"none\\\"/></w:tabs>\");\n        }\n      }\n\n      var styleDef = Object(_common__WEBPACK_IMPORTED_MODULE_5__[\"noSpaceTmp\"])(_templateObject2(), tabStops, lineHeight, marginBottom, marginLeft, hangingIndent);\n      stylesEl.insertAdjacentHTML('beforeEnd', styleDef);\n    }\n  }]);\n\n  return DocxExporterCitations;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/docx/citations.js?");

/***/ }),

/***/ "./js/modules/exporter/docx/footnotes.js":
/*!***********************************************!*\
  !*** ./js/modules/exporter/docx/footnotes.js ***!
  \***********************************************/
/*! exports provided: DocxExporterFootnotes */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DocxExporterFootnotes\", function() { return DocxExporterFootnotes; });\n/* harmony import */ var _rels__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rels */ \"./js/modules/exporter/docx/rels.js\");\n/* harmony import */ var _citations__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./citations */ \"./js/modules/exporter/docx/citations.js\");\n/* harmony import */ var _images__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./images */ \"./js/modules/exporter/docx/images.js\");\n/* harmony import */ var _lists__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./lists */ \"./js/modules/exporter/docx/lists.js\");\n/* harmony import */ var _richtext__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./richtext */ \"./js/modules/exporter/docx/richtext.js\");\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n    <w:style w:type=\\\"character\\\" w:styleId=\\\"FootnoteAnchor\\\">\\n        <w:name w:val=\\\"Footnote Anchor\\\" />\\n        <w:rPr>\\n            <w:vertAlign w:val=\\\"superscript\\\" />\\n        </w:rPr>\\n    </w:style>\\n    \"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n    <w:style w:type=\\\"paragraph\\\" w:styleId=\\\"Footnote\\\">\\n        <w:name w:val=\\\"Footnote Text\\\" />\\n        <w:basedOn w:val=\\\"Normal\\\" />\\n        <w:pPr>\\n            <w:suppressLineNumbers />\\n            <w:ind w:left=\\\"339\\\" w:hanging=\\\"339\\\" />\\n        </w:pPr>\\n        <w:rPr>\\n            <w:sz w:val=\\\"20\\\" />\\n            <w:szCs w:val=\\\"20\\\" />\\n        </w:rPr>\\n    </w:style>\\n    \"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    <w:footnotePr>\\n        <w:numFmt w:val=\\\"decimal\\\"/>\\n        <w:footnote w:id=\\\"0\\\"/>\\n        <w:footnote w:id=\\\"1\\\"/>\\n    </w:footnotePr>\\n    \"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    <w:footnotes xmlns:o=\\\"urn:schemas-microsoft-com:office:office\\\" xmlns:r=\\\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\\\" xmlns:v=\\\"urn:schemas-microsoft-com:vml\\\" xmlns:w=\\\"http://schemas.openxmlformats.org/wordprocessingml/2006/main\\\" xmlns:w10=\\\"urn:schemas-microsoft-com:office:word\\\" xmlns:wp=\\\"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing\\\" xmlns:wps=\\\"http://schemas.microsoft.com/office/word/2010/wordprocessingShape\\\" xmlns:wpg=\\\"http://schemas.microsoft.com/office/word/2010/wordprocessingGroup\\\" xmlns:mc=\\\"http://schemas.openxmlformats.org/markup-compatibility/2006\\\" xmlns:wp14=\\\"http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing\\\" xmlns:w14=\\\"http://schemas.microsoft.com/office/word/2010/wordml\\\" mc:Ignorable=\\\"w14 wp14\\\">\\n        <w:footnote w:id=\\\"0\\\" w:type=\\\"separator\\\">\\n            <w:p>\\n                <w:r>\\n                    <w:separator />\\n                </w:r>\\n            </w:p>\\n        </w:footnote>\\n        <w:footnote w:id=\\\"1\\\" w:type=\\\"continuationSeparator\\\">\\n            <w:p>\\n                <w:r>\\n                    <w:continuationSeparator />\\n                </w:r>\\n            </w:p>\\n        </w:footnote>\\n    </w:footnotes>\\n    \"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\n\n\n\n\n\n\n\nvar DEFAULT_XML = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\\n' + Object(_common__WEBPACK_IMPORTED_MODULE_5__[\"noSpaceTmp\"])(_templateObject());\nvar DEFAULT_SETTINGS_XML = Object(_common__WEBPACK_IMPORTED_MODULE_5__[\"noSpaceTmp\"])(_templateObject2());\nvar DEFAULT_STYLE_FOOTNOTE = Object(_common__WEBPACK_IMPORTED_MODULE_5__[\"noSpaceTmp\"])(_templateObject3());\nvar DEFAULT_STYLE_FOOTNOTE_ANCHOR = Object(_common__WEBPACK_IMPORTED_MODULE_5__[\"noSpaceTmp\"])(_templateObject4());\nvar DocxExporterFootnotes =\n/*#__PURE__*/\nfunction () {\n  function DocxExporterFootnotes(exporter, docContents) {\n    _classCallCheck(this, DocxExporterFootnotes);\n\n    this.exporter = exporter;\n    this.docContents = docContents;\n    this.fnPmJSON = false;\n    this.images = false;\n    this.citations = false;\n    this.footnotes = []; // footnotes\n\n    this.fnXml = false;\n    this.ctXml = false;\n    this.styleXml = false;\n    this.filePath = 'word/footnotes.xml';\n    this.ctFilePath = \"[Content_Types].xml\";\n    this.settingsFilePath = 'word/settings.xml';\n    this.styleFilePath = 'word/styles.xml';\n  }\n\n  _createClass(DocxExporterFootnotes, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      this.findFootnotes();\n\n      if (this.footnotes.length || this.exporter.citations.citFm.citationType === 'note' && this.exporter.citations.citInfos.length) {\n        this.convertFootnotes();\n        this.rels = new _rels__WEBPACK_IMPORTED_MODULE_0__[\"DocxExporterRels\"](this.exporter, 'footnotes'); // Include the citinfos from the main body document so that they will be\n        // used for calculating the bibliography as well\n\n        this.citations = new _citations__WEBPACK_IMPORTED_MODULE_1__[\"DocxExporterCitations\"](this.exporter, this.exporter.bibDB, this.exporter.citationStyles, this.exporter.citationLocales, this.fnPmJSON, this.exporter.citations.citInfos);\n        this.images = new _images__WEBPACK_IMPORTED_MODULE_2__[\"DocxExporterImages\"](this.exporter, this.exporter.imageDB, this.rels, this.fnPmJSON);\n        this.lists = new _lists__WEBPACK_IMPORTED_MODULE_3__[\"DocxExporterLists\"](this.exporter, this.rels, this.fnPmJSON);\n        return this.citations.init().then(function () {\n          // Replace the main bibliography with the new one that\n          // includes both citations in main document\n          // and in the footnotes.\n          _this.exporter.pmBib = _this.citations.pmBib;\n          return _this.rels.init();\n        }).then(function () {\n          return _this.images.init();\n        }).then(function () {\n          return _this.lists.init();\n        }).then(function () {\n          return _this.initCt();\n        }).then(function () {\n          return _this.setSettings();\n        }).then(function () {\n          return _this.addStyles();\n        }).then(function () {\n          return _this.createXml();\n        });\n      } else {\n        // No footnotes were found.\n        return Promise.resolve();\n      }\n    }\n  }, {\n    key: \"initCt\",\n    value: function initCt() {\n      var _this2 = this;\n\n      return this.exporter.xml.getXml(this.ctFilePath).then(function (ctXml) {\n        _this2.ctXml = ctXml;\n\n        _this2.addRelsToCt();\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"addRelsToCt\",\n    value: function addRelsToCt() {\n      var override = this.ctXml.querySelector(\"Override[PartName=\\\"/\".concat(this.filePath, \"\\\"]\"));\n\n      if (!override) {\n        var types = this.ctXml.querySelector('Types');\n        types.insertAdjacentHTML('beforeEnd', \"<Override PartName=\\\"/\".concat(this.filePath, \"\\\" ContentType=\\\"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml\\\"/>\"));\n      }\n    }\n  }, {\n    key: \"addStyles\",\n    value: function addStyles() {\n      var _this3 = this;\n\n      return this.exporter.xml.getXml(this.styleFilePath).then(function (styleXml) {\n        _this3.styleXml = styleXml;\n\n        _this3.addStyle('Footnote', DEFAULT_STYLE_FOOTNOTE);\n\n        _this3.addStyle('FootnoteAnchor', DEFAULT_STYLE_FOOTNOTE_ANCHOR);\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"addStyle\",\n    value: function addStyle(styleName, xml) {\n      if (!this.styleXml.querySelector(\"style[*|styleId=\\\"\".concat(styleName, \"\\\"]\"))) {\n        var stylesEl = this.styleXml.querySelector('styles');\n        stylesEl.insertAdjacentHTML('beforeEnd', xml);\n      }\n    }\n  }, {\n    key: \"findFootnotes\",\n    value: function findFootnotes() {\n      var _this4 = this;\n\n      Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_6__[\"descendantNodes\"])(this.docContents).forEach(function (node) {\n        if (node.type === 'footnote') {\n          _this4.footnotes.push(node.attrs.footnote);\n        }\n      });\n    }\n  }, {\n    key: \"convertFootnotes\",\n    value: function convertFootnotes() {\n      var fnContent = [];\n      this.footnotes.forEach(function (footnote) {\n        fnContent.push({\n          type: 'footnotecontainer',\n          content: footnote\n        });\n      });\n      this.fnPmJSON = {\n        type: 'doc',\n        content: fnContent\n      };\n    }\n  }, {\n    key: \"createXml\",\n    value: function createXml() {\n      var _this5 = this;\n\n      this.richtext = new _richtext__WEBPACK_IMPORTED_MODULE_4__[\"DocxExporterRichtext\"](this.exporter, this.rels, this.citations, this.images);\n      this.fnXml = this.richtext.transformRichtext(this.fnPmJSON); // TODO: add max dimensions\n\n      this.exporter.rels.addFootnoteRel();\n      return this.exporter.xml.getXml(this.filePath, DEFAULT_XML).then(function (xml) {\n        var footnotesEl = xml.querySelector('footnotes');\n        footnotesEl.insertAdjacentHTML('beforeEnd', _this5.fnXml);\n        _this5.xml = xml;\n      });\n    }\n  }, {\n    key: \"setSettings\",\n    value: function setSettings() {\n      var _this6 = this;\n\n      return this.exporter.xml.getXml(this.settingsFilePath).then(function (settingsXml) {\n        var footnotePr = settingsXml.querySelector('footnotePr');\n\n        if (!footnotePr) {\n          var settingsEl = settingsXml.querySelector('settings');\n          settingsEl.insertAdjacentHTML('beforeEnd', DEFAULT_SETTINGS_XML);\n        }\n\n        _this6.settingsXml = settingsXml;\n        return Promise.resolve();\n      });\n    }\n  }]);\n\n  return DocxExporterFootnotes;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/docx/footnotes.js?");

/***/ }),

/***/ "./js/modules/exporter/docx/images.js":
/*!********************************************!*\
  !*** ./js/modules/exporter/docx/images.js ***!
  \********************************************/
/*! exports provided: DocxExporterImages */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DocxExporterImages\", function() { return DocxExporterImages; });\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\nvar DocxExporterImages =\n/*#__PURE__*/\nfunction () {\n  function DocxExporterImages(exporter, imageDB, rels, docContents) {\n    _classCallCheck(this, DocxExporterImages);\n\n    this.exporter = exporter;\n    this.imageDB = imageDB;\n    this.rels = rels;\n    this.docContents = docContents;\n    this.imgIdTranslation = {};\n    this.ctXml = false;\n  }\n\n  _createClass(DocxExporterImages, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.exporter.xml.getXml(\"[Content_Types].xml\").then(function (ctXml) {\n        _this.ctXml = ctXml;\n        return _this.exportImages();\n      });\n    } // add an image to the list of files\n\n  }, {\n    key: \"addImage\",\n    value: function addImage(imgFileName, image) {\n      var rId = this.rels.addImageRel(imgFileName);\n      this.addContentType(imgFileName.split('.').pop());\n      this.exporter.xml.addExtraFile(\"word/media/\".concat(imgFileName), image);\n      return rId;\n    } // add a global contenttype declaration for an image type (if needed)\n\n  }, {\n    key: \"addContentType\",\n    value: function addContentType(fileEnding) {\n      var types = this.ctXml.querySelector('Types');\n      var contentDec = types.querySelector('Default[Extension=' + fileEnding + ']');\n\n      if (!contentDec) {\n        var string = \"<Default ContentType=\\\"image/\".concat(fileEnding, \"\\\" Extension=\\\"\").concat(fileEnding, \"\\\"/>\");\n        types.insertAdjacentHTML('beforeEnd', string);\n      }\n    } // Find all images used in file and add these to the export zip.\n    // TODO: This will likely fail on image types docx doesn't support such as SVG.\n    // Try out and fix.\n\n  }, {\n    key: \"exportImages\",\n    value: function exportImages() {\n      var _this2 = this;\n\n      var usedImgs = [];\n      Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__[\"descendantNodes\"])(this.docContents).forEach(function (node) {\n        if (node.type === 'figure' && node.attrs.image !== false) {\n          if (!(node.attrs.image in usedImgs)) {\n            usedImgs.push(node.attrs.image);\n          }\n        }\n      });\n      return new Promise(function (resolveExportImages) {\n        var p = [];\n        usedImgs.forEach(function (image) {\n          var imgDBEntry = _this2.imageDB.db[image];\n          p.push(new Promise(function (resolve) {\n            __webpack_require__.e(/*! import() */ 1).then(__webpack_require__.t.bind(null, /*! jszip-utils */ \"./node_modules/jszip-utils/lib/index.js\", 7)).then(function (_ref) {\n              var JSZipUtils = _ref[\"default\"];\n              return JSZipUtils.getBinaryContent(imgDBEntry.image, function (err, imageFile) {\n                var wImgId = _this2.addImage(imgDBEntry.image.split('/').pop(), imageFile);\n\n                _this2.imgIdTranslation[image] = wImgId;\n                resolve();\n              });\n            });\n          }));\n        });\n        Promise.all(p).then(function () {\n          resolveExportImages();\n        });\n      });\n    }\n  }]);\n\n  return DocxExporterImages;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/docx/images.js?");

/***/ }),

/***/ "./js/modules/exporter/docx/index.js":
/*!*******************************************!*\
  !*** ./js/modules/exporter/docx/index.js ***!
  \*******************************************/
/*! exports provided: DocxExporter */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DocxExporter\", function() { return DocxExporter; });\n/* harmony import */ var _tools_file__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../tools/file */ \"./js/modules/exporter/tools/file.js\");\n/* harmony import */ var _tools_xml_zip__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../tools/xml_zip */ \"./js/modules/exporter/tools/xml_zip.js\");\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\n/* harmony import */ var _citations__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./citations */ \"./js/modules/exporter/docx/citations.js\");\n/* harmony import */ var _images__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./images */ \"./js/modules/exporter/docx/images.js\");\n/* harmony import */ var _render__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./render */ \"./js/modules/exporter/docx/render.js\");\n/* harmony import */ var _richtext__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./richtext */ \"./js/modules/exporter/docx/richtext.js\");\n/* harmony import */ var _rels__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./rels */ \"./js/modules/exporter/docx/rels.js\");\n/* harmony import */ var _footnotes__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./footnotes */ \"./js/modules/exporter/docx/footnotes.js\");\n/* harmony import */ var _metadata__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./metadata */ \"./js/modules/exporter/docx/metadata.js\");\n/* harmony import */ var _math__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./math */ \"./js/modules/exporter/docx/math.js\");\n/* harmony import */ var _tables__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./tables */ \"./js/modules/exporter/docx/tables.js\");\n/* harmony import */ var _lists__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./lists */ \"./js/modules/exporter/docx/lists.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/*\nExporter to Office Open XML docx (Microsoft Word)\n*/\n\n/*\nTODO:\n* - Export comments\n* - Export document language\n* - Templating of tag/contributor output\n*/\n\nvar DocxExporter =\n/*#__PURE__*/\nfunction () {\n  function DocxExporter(doc, templateUrl, bibDB, imageDB, citationStyles, citationLocales, staticUrl) {\n    _classCallCheck(this, DocxExporter);\n\n    this.doc = doc;\n    this.templateUrl = templateUrl;\n    this.bibDB = bibDB;\n    this.imageDB = imageDB;\n    this.citationStyles = citationStyles;\n    this.citationLocales = citationLocales;\n    this.staticUrl = staticUrl;\n    this.pmBib = false;\n    this.docContents = false;\n    this.docTitle = false;\n  }\n\n  _createClass(DocxExporter, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      this.docContents = Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_2__[\"fixTables\"])(Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_2__[\"removeHidden\"])(this.doc.contents));\n      this.docTitle = Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_2__[\"textContent\"])(this.docContents.content[0]);\n      this.tables = new _tables__WEBPACK_IMPORTED_MODULE_11__[\"DocxExporterTables\"](this);\n      this.math = new _math__WEBPACK_IMPORTED_MODULE_10__[\"DocxExporterMath\"](this);\n      this.metadata = new _metadata__WEBPACK_IMPORTED_MODULE_9__[\"DocxExporterMetadata\"](this, this.docContents);\n      this.footnotes = new _footnotes__WEBPACK_IMPORTED_MODULE_8__[\"DocxExporterFootnotes\"](this, this.docContents);\n      this.render = new _render__WEBPACK_IMPORTED_MODULE_5__[\"DocxExporterRender\"](this, this.docContents);\n      this.rels = new _rels__WEBPACK_IMPORTED_MODULE_7__[\"DocxExporterRels\"](this, 'document');\n      this.images = new _images__WEBPACK_IMPORTED_MODULE_4__[\"DocxExporterImages\"](this, this.imageDB, this.rels, this.docContents);\n      this.lists = new _lists__WEBPACK_IMPORTED_MODULE_12__[\"DocxExporterLists\"](this, this.rels, this.docContents);\n      this.citations = new _citations__WEBPACK_IMPORTED_MODULE_3__[\"DocxExporterCitations\"](this, this.bibDB, this.citationStyles, this.citationLocales, this.docContents);\n      this.richtext = new _richtext__WEBPACK_IMPORTED_MODULE_6__[\"DocxExporterRichtext\"](this, this.rels, this.citations, this.images);\n      this.xml = new _tools_xml_zip__WEBPACK_IMPORTED_MODULE_1__[\"XmlZip\"](Object(_tools_file__WEBPACK_IMPORTED_MODULE_0__[\"createSlug\"])(this.docTitle) + '.docx', this.templateUrl, 'application/msword');\n      this.xml.init().then(function () {\n        return _this.citations.init();\n      }).then(function () {\n        _this.pmBib = _this.citations.pmBib;\n        return _this.metadata.init();\n      }).then(function () {\n        return _this.tables.init();\n      }).then(function () {\n        return _this.math.init();\n      }).then(function () {\n        return _this.render.init();\n      }).then(function () {\n        return _this.rels.init();\n      }).then(function () {\n        return _this.images.init();\n      }).then(function () {\n        return _this.lists.init();\n      }).then(function () {\n        return _this.footnotes.init();\n      }).then(function () {\n        _this.render.getTagData(_this.pmBib);\n\n        _this.render.render();\n\n        _this.xml.prepareAndDownload();\n      });\n    }\n  }]);\n\n  return DocxExporter;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/docx/index.js?");

/***/ }),

/***/ "./js/modules/exporter/docx/lists.js":
/*!*******************************************!*\
  !*** ./js/modules/exporter/docx/lists.js ***!
  \*******************************************/
/*! exports provided: DocxExporterLists */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DocxExporterLists\", function() { return DocxExporterLists; });\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n                <w:lvl w:ilvl=\\\"\", \"\\\" w:tplc=\\\"0409000F\\\">\\n                    <w:start w:val=\\\"1\\\" />\\n                    <w:numFmt w:val=\\\"decimal\\\" />\\n                    <w:lvlText w:val=\\\"%\", \".\\\" />\\n                    <w:lvlJc w:val=\\\"left\\\" />\\n                    <w:pPr>\\n                        <w:ind w:left=\\\"\", \"\\\" w:hanging=\\\"360\\\" />\\n                    </w:pPr>\\n                </w:lvl>\\n            \"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n            <w:abstractNum w:abstractNumId=\\\"\", \"\\\" w15:restartNumberingAfterBreak=\\\"0\\\">\\n                <w:nsid w:val=\\\"7F6635F3\\\" />\\n                <w:multiLevelType w:val=\\\"hybridMultilevel\\\" />\\n                <w:tmpl w:val=\\\"BFFEF214\\\" />\\n            </w:abstractNum>\\n        \"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n            <w:num w:numId=\\\"\", \"\\\">\\n                <w:abstractNumId w:val=\\\"\", \"\\\" />\\n            </w:num>\\n        \"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n                <w:lvl w:ilvl=\\\"\", \"\\\" w:tplc=\\\"04090001\\\" w:tentative=\\\"1\\\">\\n                    <w:start w:val=\\\"1\\\" />\\n                    <w:numFmt w:val=\\\"bullet\\\" />\\n                    <w:lvlText w:val=\\\"\\uF0B7\\\" />\\n                    <w:lvlJc w:val=\\\"left\\\" />\\n                    <w:pPr>\\n                        <w:ind w:left=\\\"\", \"\\\" w:hanging=\\\"360\\\" />\\n                    </w:pPr>\\n                    <w:rPr>\\n                        <w:rFonts w:ascii=\\\"Symbol\\\" w:hAnsi=\\\"Symbol\\\" w:hint=\\\"default\\\" />\\n                    </w:rPr>\\n                </w:lvl>\\n            \"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n            <w:abstractNum w:abstractNumId=\\\"\", \"\\\" w15:restartNumberingAfterBreak=\\\"0\\\">\\n                <w:nsid w:val=\\\"3620195A\\\" />\\n                <w:multiLevelType w:val=\\\"hybridMultilevel\\\" />\\n                <w:tmpl w:val=\\\"A74C9E6A\\\" />\\n            </w:abstractNum>\\n            <w:num w:numId=\\\"\", \"\\\">\\n                <w:abstractNumId w:val=\\\"\", \"\\\" />\\n            </w:num>\\n        \"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    <w:numbering xmlns:wpc=\\\"http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas\\\" xmlns:cx=\\\"http://schemas.microsoft.com/office/drawing/2014/chartex\\\" xmlns:cx1=\\\"http://schemas.microsoft.com/office/drawing/2015/9/8/chartex\\\" xmlns:cx2=\\\"http://schemas.microsoft.com/office/drawing/2015/10/21/chartex\\\" xmlns:cx3=\\\"http://schemas.microsoft.com/office/drawing/2016/5/9/chartex\\\" xmlns:cx4=\\\"http://schemas.microsoft.com/office/drawing/2016/5/10/chartex\\\" xmlns:cx5=\\\"http://schemas.microsoft.com/office/drawing/2016/5/11/chartex\\\" xmlns:cx6=\\\"http://schemas.microsoft.com/office/drawing/2016/5/12/chartex\\\" xmlns:cx7=\\\"http://schemas.microsoft.com/office/drawing/2016/5/13/chartex\\\" xmlns:cx8=\\\"http://schemas.microsoft.com/office/drawing/2016/5/14/chartex\\\" xmlns:mc=\\\"http://schemas.openxmlformats.org/markup-compatibility/2006\\\" xmlns:aink=\\\"http://schemas.microsoft.com/office/drawing/2016/ink\\\" xmlns:o=\\\"urn:schemas-microsoft-com:office:office\\\" xmlns:r=\\\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\\\" xmlns:m=\\\"http://schemas.openxmlformats.org/officeDocument/2006/math\\\" xmlns:v=\\\"urn:schemas-microsoft-com:vml\\\" xmlns:wp14=\\\"http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing\\\" xmlns:wp=\\\"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing\\\" xmlns:w10=\\\"urn:schemas-microsoft-com:office:word\\\" xmlns:w=\\\"http://schemas.openxmlformats.org/wordprocessingml/2006/main\\\" xmlns:w14=\\\"http://schemas.microsoft.com/office/word/2010/wordml\\\" xmlns:w15=\\\"http://schemas.microsoft.com/office/word/2012/wordml\\\" xmlns:w16se=\\\"http://schemas.microsoft.com/office/word/2015/wordml/symex\\\" xmlns:wpg=\\\"http://schemas.microsoft.com/office/word/2010/wordprocessingGroup\\\" xmlns:wpi=\\\"http://schemas.microsoft.com/office/word/2010/wordprocessingInk\\\" xmlns:wne=\\\"http://schemas.microsoft.com/office/word/2006/wordml\\\" xmlns:wps=\\\"http://schemas.microsoft.com/office/word/2010/wordprocessingShape\\\" mc:Ignorable=\\\"w14 w15 w16se wp14\\\">\\n    </w:numbering>\\n    \"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    <w:style w:type=\\\"paragraph\\\" w:styleId=\\\"ListParagraph\\\">\\n    <w:name w:val=\\\"List Paragraph\\\"/>\\n    <w:basedOn w:val=\\\"Normal\\\"/>\\n    <w:uiPriority w:val=\\\"34\\\"/>\\n    <w:qFormat/>\\n    <w:rsid w:val=\\\"006E68A6\\\"/>\\n    <w:pPr>\\n      <w:ind w:left=\\\"720\\\"/>\\n      <w:contextualSpacing/>\\n    </w:pPr>\\n    </w:style>\\n    \"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\n\n\nvar DEFAULT_LISTPARAGRAPH_XML = Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject());\nvar DEFAULT_NUMBERING_XML = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\\n' + Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject2());\nvar DocxExporterLists =\n/*#__PURE__*/\nfunction () {\n  function DocxExporterLists(exporter, rels, docContents) {\n    _classCallCheck(this, DocxExporterLists);\n\n    this.exporter = exporter;\n    this.rels = rels;\n    this.docContents = docContents;\n    this.useBulletList = false;\n    this.usedNumberedList = 0;\n    this.styleXml = false;\n    this.numberingXml = false;\n    this.maxAbstractNumId = -1;\n    this.maxNumId = 0; // We only need one bulletType for all bullet lists, but a new\n    // numberedType for each numbered list so that the numbering starts in 1\n    // each time.\n\n    this.bulletType = false;\n    this.numberedAbstractType = false;\n    this.numberedTypes = [];\n    this.styleFilePath = 'word/styles.xml';\n    this.numberingFilePath = 'word/numbering.xml';\n    this.ctFilePath = \"[Content_Types].xml\";\n  }\n\n  _createClass(DocxExporterLists, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      this.findLists();\n\n      if (this.usedNumberedList > 0 || this.useBulletList) {\n        var p = [];\n        p.push(new Promise(function (resolve) {\n          _this.initCt().then(function () {\n            return resolve();\n          });\n        }));\n        p.push(new Promise(function (resolve) {\n          _this.addNumberingXml().then(function () {\n            return resolve();\n          });\n        }));\n        p.push(new Promise(function (resolve) {\n          _this.addListParagraphStyle().then(function () {\n            return resolve();\n          });\n        }));\n        return Promise.all(p);\n      } else {\n        return Promise.resolve();\n      }\n    }\n  }, {\n    key: \"initCt\",\n    value: function initCt() {\n      var _this2 = this;\n\n      return this.exporter.xml.getXml(this.ctFilePath).then(function (ctXml) {\n        _this2.ctXml = ctXml;\n\n        _this2.addRelsToCt();\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"addRelsToCt\",\n    value: function addRelsToCt() {\n      var override = this.ctXml.querySelector(\"Override[PartName=\\\"/\".concat(this.numberingFilePath, \"\\\"]\"));\n\n      if (!override) {\n        var types = this.ctXml.querySelector('Types');\n        types.insertAdjacentHTML('beforeEnd', \"<Override PartName=\\\"/\".concat(this.numberingFilePath, \"\\\" ContentType=\\\"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml\\\"/>\"));\n      }\n    }\n  }, {\n    key: \"findLists\",\n    value: function findLists() {\n      var _this3 = this;\n\n      Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_1__[\"descendantNodes\"])(this.docContents).forEach(function (node) {\n        if (node.type === 'bullet_list') {\n          _this3.useBulletList = true;\n        } else if (node.type === 'ordered_list') {\n          _this3.usedNumberedList += 1;\n        }\n      });\n    }\n  }, {\n    key: \"addNumberingXml\",\n    value: function addNumberingXml() {\n      var _this4 = this;\n\n      return this.exporter.xml.getXml(this.numberingFilePath, DEFAULT_NUMBERING_XML).then(function (numberingXml) {\n        _this4.numberingXml = numberingXml;\n\n        _this4.rels.addNumberingRel();\n\n        _this4.addUsedListTypes();\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"addListParagraphStyle\",\n    value: function addListParagraphStyle() {\n      var _this5 = this;\n\n      return this.exporter.xml.getXml(this.styleFilePath).then(function (styleXml) {\n        _this5.styleXml = styleXml;\n\n        if (!_this5.styleXml.querySelector(\"style[*|styleId=\\\"ListParagraph\\\"]\")) {\n          var stylesEl = _this5.styleXml.querySelector('styles');\n\n          stylesEl.insertAdjacentHTML('beforeEnd', DEFAULT_LISTPARAGRAPH_XML);\n        }\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"addUsedListTypes\",\n    value: function addUsedListTypes() {\n      var _this6 = this;\n\n      var allAbstractNum = this.numberingXml.querySelectorAll('abstractNum');\n      allAbstractNum.forEach(function (abstractNum) {\n        // We check the format for the lowest level list and use the first\n        // one we find  for 'bullet' or 'not bullet'\n        // This means that if a list is defined using anything else than\n        // bullets, it will be accepted as the format of\n        // the numeric list.\n        var levelZeroFormat = abstractNum.querySelector('lvl[*|ilvl=\"0\"] numFmt').getAttribute('w:val');\n        var abstractNumId = parseInt(abstractNum.getAttribute('w:abstractNumId'));\n\n        if (levelZeroFormat === 'bullet' && !_this6.bulletAbstractType) {\n          var numEl = _this6.numberingXml.querySelector(\"abstractNumId[*|val=\\\"\".concat(abstractNumId, \"\\\"]\")).parentElement;\n\n          var numId = parseInt(numEl.getAttribute('w:numId'));\n          _this6.bulletType = numId;\n        } else if (levelZeroFormat !== 'bullet' && !_this6.numberedAbstractType) {\n          _this6.numberedAbstractType = abstractNumId;\n        }\n\n        if (_this6.maxAbstractNumId < abstractNumId) {\n          _this6.maxAbstractNumId = abstractNumId;\n        }\n      });\n      var allNum = this.numberingXml.querySelectorAll('num');\n      allNum.forEach(function (numEl) {\n        var numId = parseInt(numEl.getAttribute('w:val'));\n\n        if (_this6.maxNumId < numId) {\n          _this6.maxNumId = numId;\n        }\n      });\n\n      if (!this.bulletType && this.useBulletList) {\n        this.maxNumId++;\n        this.maxAbstractNumId++;\n        this.addBulletNumType(this.maxNumId, this.maxAbstractNumId);\n        this.bulletType = this.maxNumId;\n      }\n\n      if (!this.numberedAbstractType && this.usedNumberedList > 0) {\n        this.maxAbstractNumId++;\n        this.addNumberedAbstractNumType(this.maxAbstractNumId);\n        this.numberedAbstractType = this.maxAbstractNumId;\n      }\n\n      for (var i = 0; i < this.usedNumberedList; i++) {\n        this.maxNumId++;\n        var numId = this.maxNumId;\n        this.addNumberedNumType(numId, this.numberedAbstractType);\n        this.numberedTypes.push(numId);\n      }\n    }\n  }, {\n    key: \"getBulletType\",\n    value: function getBulletType() {\n      return this.bulletType;\n    }\n  }, {\n    key: \"getNumberedType\",\n    value: function getNumberedType() {\n      return this.numberedTypes.shift();\n    }\n  }, {\n    key: \"addBulletNumType\",\n    value: function addBulletNumType(numId, abstractNumId) {\n      var numberingEl = this.numberingXml.querySelector('numbering');\n      numberingEl.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject3(), abstractNumId, numId, abstractNumId));\n      var newAbstractNum = this.numberingXml.querySelector(\"abstractNum[*|abstractNumId=\\\"\".concat(abstractNumId, \"\\\"]\")); // Definition seem to always define 9 levels (0-8).\n\n      for (var level = 0; level < 9; level++) {\n        newAbstractNum.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject4(), level, (level + 1) * 720));\n      }\n    }\n  }, {\n    key: \"addNumberedNumType\",\n    value: function addNumberedNumType(numId, abstractNumId) {\n      var numberingEl = this.numberingXml.querySelector('numbering');\n      numberingEl.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject5(), numId, abstractNumId));\n    }\n  }, {\n    key: \"addNumberedAbstractNumType\",\n    value: function addNumberedAbstractNumType(abstractNumId) {\n      var numberingEl = this.numberingXml.querySelector('numbering');\n      numberingEl.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject6(), abstractNumId));\n      var newAbstractNum = this.numberingXml.querySelector(\"abstractNum[*|abstractNumId=\\\"\".concat(abstractNumId, \"\\\"]\")); // Definition seem to always define 9 levels (0-8).\n\n      for (var level = 0; level < 9; level++) {\n        newAbstractNum.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject7(), level, level + 1, (level + 1) * 720));\n      }\n    }\n  }]);\n\n  return DocxExporterLists;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/docx/lists.js?");

/***/ }),

/***/ "./js/modules/exporter/docx/math.js":
/*!******************************************!*\
  !*** ./js/modules/exporter/docx/math.js ***!
  \******************************************/
/*! exports provided: DocxExporterMath */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DocxExporterMath\", function() { return DocxExporterMath; });\n/* harmony import */ var texzilla__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! texzilla */ \"./node_modules/texzilla/TeXZilla.js\");\n/* harmony import */ var texzilla__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(texzilla__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    <w:font w:name=\\\"Cambria Math\\\">\\n        <w:panose1 w:val=\\\"02040503050406030204\\\" />\\n        <w:charset w:val=\\\"00\\\" />\\n        <w:family w:val=\\\"roman\\\" />\\n        <w:pitch w:val=\\\"variable\\\" />\\n        <w:sig w:usb0=\\\"E00002FF\\\" w:usb1=\\\"420024FF\\\" w:usb2=\\\"00000000\\\" w:usb3=\\\"00000000\\\" w:csb0=\\\"0000019F\\\" w:csb1=\\\"00000000\\\" />\\n    </w:font>\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\n\n // Not entirely sure if we need this font here. This is included whenever Word\n// itself adds a formula, but our ooml doesn't refer to the font, so it may be pointless.\n\nvar CAMBRIA_MATH_FONT_DECLARATION = Object(_common__WEBPACK_IMPORTED_MODULE_1__[\"noSpaceTmp\"])(_templateObject());\nvar DocxExporterMath =\n/*#__PURE__*/\nfunction () {\n  function DocxExporterMath(exporter) {\n    _classCallCheck(this, DocxExporterMath);\n\n    this.exporter = exporter;\n    this.fontTableXml = false;\n    this.addedCambriaMath = false;\n    this.processor = new window.XSLTProcessor();\n  }\n\n  _createClass(DocxExporterMath, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.exporter.xml.getXml(\"word/fontTable.xml\").then(function (fontTableXml) {\n        _this.fontTableXml = fontTableXml;\n        return _this.setupXslt();\n      });\n    }\n  }, {\n    key: \"setupXslt\",\n    value: function setupXslt() {\n      var _this2 = this;\n\n      return fetch(\"\".concat(this.exporter.staticUrl, \"xsl/mml2omml.xsl?v=\").concat(1563278625)).then(function (response) {\n        return response.text();\n      }).then(function (xmlString) {\n        var parser = new window.DOMParser();\n        var xsl = parser.parseFromString(xmlString, \"text/xml\").querySelector('stylesheet');\n\n        _this2.processor.importStylesheet(xsl);\n      });\n    }\n  }, {\n    key: \"getOmml\",\n    value: function getOmml(latex) {\n      if (!this.addedCambriaMath) {\n        var fontsEl = this.fontTableXml.querySelector('fonts');\n        fontsEl.insertAdjacentHTML('beforeEnd', CAMBRIA_MATH_FONT_DECLARATION);\n        this.addedCambriaMath = true;\n      }\n\n      var mathml = texzilla__WEBPACK_IMPORTED_MODULE_0___default.a.toMathML(latex);\n      var omml = this.processor.transformToDocument(mathml);\n      return omml.firstChild.outerHTML;\n    }\n  }]);\n\n  return DocxExporterMath;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/docx/math.js?");

/***/ }),

/***/ "./js/modules/exporter/docx/metadata.js":
/*!**********************************************!*\
  !*** ./js/modules/exporter/docx/metadata.js ***!
  \**********************************************/
/*! exports provided: DocxExporterMetadata */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DocxExporterMetadata\", function() { return DocxExporterMetadata; });\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar DocxExporterMetadata =\n/*#__PURE__*/\nfunction () {\n  function DocxExporterMetadata(exporter, docContents) {\n    _classCallCheck(this, DocxExporterMetadata);\n\n    this.exporter = exporter;\n    this.docContents = docContents;\n    this.coreXml = false;\n    this.metadata = {\n      authors: this.docContents.content.reduce(function (authors, part) {\n        if (part.type === 'contributors_part' && part.attrs.metadata === 'authors' && part.content) {\n          return authors.concat(part.content.map(function (authorNode) {\n            return authorNode.attrs;\n          }));\n        } else {\n          return authors;\n        }\n      }, []),\n      keywords: this.docContents.content.reduce(function (keywords, part) {\n        if (part.type === 'tags_part' && part.attrs.metadata === 'keywords' && part.content) {\n          return keywords.concat(part.content.map(function (keywordNode) {\n            return keywordNode.attrs.tag;\n          }));\n        } else {\n          return keywords;\n        }\n      }, []),\n      title: Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__[\"textContent\"])(this.docContents.content[0])\n    };\n  }\n\n  _createClass(DocxExporterMetadata, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.exporter.xml.getXml(\"docProps/core.xml\").then(function (coreXml) {\n        _this.coreXml = coreXml;\n\n        _this.addMetadata();\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"addMetadata\",\n    value: function addMetadata() {\n      var corePropertiesEl = this.coreXml.querySelector('coreProperties'); // Title\n\n      var titleEl = this.coreXml.querySelector('title');\n\n      if (!titleEl) {\n        corePropertiesEl.insertAdjacentHTML('beforeEnd', '<dc:title></dc:title>');\n        titleEl = this.coreXml.querySelector('title');\n      }\n\n      titleEl.innerHTML = Object(_common__WEBPACK_IMPORTED_MODULE_1__[\"escapeText\"])(this.metadata.title); // Authors\n\n      var authors = this.metadata.authors.map(function (author) {\n        var nameParts = [];\n\n        if (author.firstname) {\n          nameParts.push(author.firstname);\n        }\n\n        if (author.lastname) {\n          nameParts.push(author.lastname);\n        }\n\n        if (!nameParts.length && author.institution) {\n          // We have an institution but no names. Use institution as name.\n          nameParts.push(author.institution);\n        }\n\n        return nameParts.join(' ');\n      });\n      var lastAuthor = authors.length ? Object(_common__WEBPACK_IMPORTED_MODULE_1__[\"escapeText\"])(authors[0]) : gettext('Unknown');\n      var allAuthors = authors.length ? Object(_common__WEBPACK_IMPORTED_MODULE_1__[\"escapeText\"])(authors.join(';')) : gettext('Unknown');\n      var allAuthorsEl = this.coreXml.querySelector('creator');\n\n      if (!allAuthorsEl) {\n        corePropertiesEl.insertAdjacentHTML('beforeEnd', '<dc:creator></dc:creator>');\n        allAuthorsEl = this.coreXml.querySelector('creator');\n      }\n\n      allAuthorsEl.innerHTML = allAuthors;\n      var lastAuthorEl = this.coreXml.querySelector('lastModifiedBy');\n\n      if (!lastAuthorEl) {\n        corePropertiesEl.insertAdjacentHTML('beforeEnd', '<dc:lastModifiedBy></dc:lastModifiedBy>');\n        lastAuthorEl = this.coreXml.querySelector('lastModifiedBy');\n      }\n\n      lastAuthorEl.innerHTML = lastAuthor; // Keywords\n\n      if (this.metadata.keywords.length) {\n        // It is not really clear how keywords should be separated in DOCX files,\n        // so we use \", \".\n        var keywordsString = Object(_common__WEBPACK_IMPORTED_MODULE_1__[\"escapeText\"])(this.metadata.keywords.join(', '));\n        var keywordsEl = this.coreXml.querySelector('keywords');\n\n        if (!keywordsEl) {\n          corePropertiesEl.insertAdjacentHTML('beforeEnd', '<cp:keywords></cp:keywords>');\n          keywordsEl = this.coreXml.querySelector('keywords');\n        }\n\n        keywordsEl.innerHTML = keywordsString;\n      } // time\n\n\n      var date = new Date();\n      var dateString = date.toISOString().split('.')[0] + 'Z';\n      var createdEl = this.coreXml.querySelector('created');\n      createdEl.innerHTML = dateString;\n      var modifiedEl = this.coreXml.querySelector('modified');\n\n      if (!modifiedEl) {\n        corePropertiesEl.insertAdjacentHTML('beforeEnd', '<dcterms:modified xsi:type=\"dcterms:W3CDTF\"></dcterms:modified>');\n        modifiedEl = this.coreXml.querySelector('modified');\n      }\n\n      modifiedEl.innerHTML = dateString;\n    }\n  }]);\n\n  return DocxExporterMetadata;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/docx/metadata.js?");

/***/ }),

/***/ "./js/modules/exporter/docx/rels.js":
/*!******************************************!*\
  !*** ./js/modules/exporter/docx/rels.js ***!
  \******************************************/
/*! exports provided: DocxExporterRels */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DocxExporterRels\", function() { return DocxExporterRels; });\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n// manages the .rels files. Need to initialize one for each of document.xml and footnotes.xml\n\nvar DEFAULT_XML = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<Relationships xmlns=\\\"http://schemas.openxmlformats.org/package/2006/relationships\\\"></Relationships>\";\nvar DocxExporterRels =\n/*#__PURE__*/\nfunction () {\n  function DocxExporterRels(exporter, docName) {\n    _classCallCheck(this, DocxExporterRels);\n\n    this.exporter = exporter;\n    this.docName = docName;\n    this.xml = false;\n    this.ctXml = false;\n    this.maxRelId = 0;\n    this.filePath = \"word/_rels/\".concat(this.docName, \".xml.rels\");\n    this.ctFilePath = \"[Content_Types].xml\";\n  }\n\n  _createClass(DocxExporterRels, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.initCt().then(function () {\n        return _this.exporter.xml.getXml(_this.filePath, DEFAULT_XML);\n      }).then(function (xml) {\n        _this.xml = xml;\n\n        _this.findMaxRelId();\n      });\n    }\n  }, {\n    key: \"initCt\",\n    value: function initCt() {\n      var _this2 = this;\n\n      return this.exporter.xml.getXml(this.ctFilePath).then(function (ctXml) {\n        _this2.ctXml = ctXml;\n\n        _this2.addRelsToCt();\n\n        return Promise.resolve();\n      });\n    } // Go through a rels xml file and file all the listed relations\n\n  }, {\n    key: \"findMaxRelId\",\n    value: function findMaxRelId() {\n      var _this3 = this;\n\n      var rels = this.xml.querySelectorAll('Relationship');\n      rels.forEach(function (rel) {\n        var id = parseInt(rel.getAttribute(\"Id\").replace(/\\D/g, ''));\n\n        if (id > _this3.maxRelId) {\n          _this3.maxRelId = id;\n        }\n      });\n    }\n  }, {\n    key: \"addRelsToCt\",\n    value: function addRelsToCt() {\n      var override = this.ctXml.querySelector(\"Override[PartName=\\\"/\".concat(this.filePath, \"\\\"]\"));\n\n      if (!override) {\n        var types = this.ctXml.querySelector('Types');\n        types.insertAdjacentHTML('beforeEnd', \"<Override PartName=\\\"/\".concat(this.filePath, \"\\\" ContentType=\\\"application/vnd.openxmlformats-package.relationships+xml\\\"/>\"));\n      }\n    } // Add a relationship for a link\n\n  }, {\n    key: \"addLinkRel\",\n    value: function addLinkRel(link) {\n      var rels = this.xml.querySelector('Relationships');\n      var rId = this.maxRelId + 1;\n      var string = \"<Relationship Id=\\\"rId\".concat(rId, \"\\\" Type=\\\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink\\\" Target=\\\"\").concat(Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"escapeText\"])(link), \"\\\" TargetMode=\\\"External\\\"/>\");\n      rels.insertAdjacentHTML('beforeEnd', string);\n      this.maxRelId = rId;\n      return rId;\n    } // add a relationship for an image\n\n  }, {\n    key: \"addImageRel\",\n    value: function addImageRel(imgFileName) {\n      var rels = this.xml.querySelector('Relationships');\n      var rId = this.maxRelId + 1;\n      var string = \"<Relationship Id=\\\"rId\".concat(rId, \"\\\" Type=\\\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\\\" Target=\\\"media/\").concat(Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"escapeText\"])(imgFileName), \"\\\"/>\");\n      rels.insertAdjacentHTML('beforeEnd', string);\n      this.maxRelId = rId;\n      return rId;\n    }\n  }, {\n    key: \"addFootnoteRel\",\n    value: function addFootnoteRel() {\n      var footnotesRel = this.xml.querySelector('Relationship[Target=\"footnotes.xml\"]');\n\n      if (footnotesRel) {\n        // Rel exists already\n        var fnRId = parseInt(footnotesRel.getAttribute('Id').replace(/\\D/g, ''));\n        return fnRId;\n      }\n\n      var rels = this.xml.querySelector('Relationships');\n      var rId = this.maxRelId + 1;\n      var string = \"<Relationship Id=\\\"rId\".concat(rId, \"\\\" Type=\\\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/footnotes\\\" Target=\\\"footnotes.xml\\\"/>\");\n      rels.insertAdjacentHTML('beforeEnd', string);\n      this.maxRelId = rId;\n      return rId;\n    }\n  }, {\n    key: \"addNumberingRel\",\n    value: function addNumberingRel() {\n      var numberingRel = this.xml.querySelector('Relationship[Target=\"numbering.xml\"]');\n\n      if (numberingRel) {\n        // Rel exists already\n        var nuRId = parseInt(numberingRel.getAttribute('Id').replace(/\\D/g, ''));\n        return nuRId;\n      }\n\n      var rels = this.xml.querySelector('Relationships');\n      var rId = this.maxRelId + 1;\n      var string = \"<Relationship Id=\\\"rId\".concat(rId, \"\\\" Type=\\\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/numbering\\\" Target=\\\"numbering.xml\\\"/>\");\n      rels.insertAdjacentHTML('beforeEnd', string);\n      this.maxRelId = rId;\n      return rId;\n    }\n  }]);\n\n  return DocxExporterRels;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/docx/rels.js?");

/***/ }),

/***/ "./js/modules/exporter/docx/render.js":
/*!********************************************!*\
  !*** ./js/modules/exporter/docx/render.js ***!
  \********************************************/
/*! exports provided: DocxExporterRender */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DocxExporterRender\", function() { return DocxExporterRender; });\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\n/* harmony import */ var _schema_i18n__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../schema/i18n */ \"./js/modules/schema/i18n.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\nvar DocxExporterRender =\n/*#__PURE__*/\nfunction () {\n  function DocxExporterRender(exporter, docContents) {\n    _classCallCheck(this, DocxExporterRender);\n\n    this.exporter = exporter;\n    this.docContents = docContents;\n    this.filePath = \"word/document.xml\";\n    this.xml = false;\n  }\n\n  _createClass(DocxExporterRender, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.exporter.xml.getXml(this.filePath).then(function (xml) {\n        return _this.xml = xml;\n      });\n    } // Define the tags that are to be looked for in the document\n\n  }, {\n    key: \"getTagData\",\n    value: function getTagData(pmBib) {\n      this.tags = this.docContents.content.map(function (node) {\n        var tag = {};\n\n        switch (node.type) {\n          case 'title':\n            tag.title = 'title';\n            tag.content = Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__[\"textContent\"])(node);\n            break;\n\n          case 'heading_part':\n            tag.title = node.attrs.id;\n            tag.content = Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__[\"textContent\"])(node);\n            break;\n\n          case 'table_part':\n          case 'richtext_part':\n            tag.title = \"@\".concat(node.attrs.id);\n            tag.content = node.content;\n            break;\n\n          case 'contributors_part':\n            tag.title = node.attrs.id; // TODO: This is a very basic reduction of the author info into\n            // a simple string. We should expand the templating system so\n            // that one can specify more about the output.\n\n            tag.content = node.content ? node.content.map(function (node) {\n              var contributor = node.attrs,\n                  nameParts = [];\n              var affiliation = false;\n\n              if (contributor.firstname) {\n                nameParts.push(contributor.firstname);\n              }\n\n              if (contributor.lastname) {\n                nameParts.push(contributor.lastname);\n              }\n\n              if (contributor.institution) {\n                if (nameParts.length) {\n                  affiliation = contributor.institution;\n                } else {\n                  // We have an institution but no names. Use institution as name.\n                  nameParts.push(contributor.institution);\n                }\n              }\n\n              var parts = [nameParts.join(' ')];\n\n              if (affiliation) {\n                parts.push(affiliation);\n              }\n\n              if (contributor.email) {\n                parts.push(contributor.email);\n              }\n\n              return parts.join(', ');\n            }).join('; ') : '';\n            break;\n\n          case 'tags_part':\n            tag.title = node.attrs.id;\n            tag.content = node.content ? node.content.map(function (node) {\n              return node.attrs.tag;\n            }).join(', ') : '';\n            break;\n        }\n\n        return tag;\n      });\n      var settings = this.exporter.doc.settings,\n          bibliographyHeader = settings.bibliography_header[settings.language] || _schema_i18n__WEBPACK_IMPORTED_MODULE_2__[\"BIBLIOGRAPHY_HEADERS\"][settings.language];\n      this.tags.push({\n        title: '@bibliography',\n        // The '@' triggers handling as block\n        content: pmBib ? [{\n          type: 'bibliography_heading',\n          content: [{\n            type: 'text',\n            text: bibliographyHeader\n          }]\n        }].concat(pmBib.content) : [{\n          type: 'paragraph',\n          content: [{\n            type: 'text',\n            text: ' '\n          }]\n        }]\n      });\n    } // go through document.xml looking for tags and replace them with the given\n    // replacements.\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      // Including global page definition at end\n      var pars = this.xml.querySelectorAll('p,sectPr');\n      var currentTags = [];\n      pars.forEach(function (par) {\n        // Assuming there is nothing outside of <w:t>...</w:t>\n        var text = par.textContent;\n\n        _this2.tags.forEach(function (tag) {\n          var tagString = tag.title;\n\n          if (text.includes(\"{\".concat(tagString, \"}\"))) {\n            currentTags.push(tag);\n            tag.par = par; // We don't worry about the same tag appearing twice in the document,\n            // as that would make no sense.\n          }\n        });\n\n        var pageSize = par.querySelector('pgSz');\n        var pageMargins = par.querySelector('pgMar');\n        var cols = par.querySelector('cols');\n\n        if (pageSize && pageMargins && cols) {\n          // Not sure if these all need to come together\n          var width = parseInt(pageSize.getAttribute('w:w')) - parseInt(pageMargins.getAttribute('w:right')) - parseInt(pageMargins.getAttribute('w:left'));\n          var height = parseInt(pageSize.getAttribute('w:h')) - parseInt(pageMargins.getAttribute('w:bottom')) - parseInt(pageMargins.getAttribute('w:top')) - parseInt(pageMargins.getAttribute('w:header')) - parseInt(pageMargins.getAttribute('w:footer'));\n          var colCount = parseInt(cols.getAttribute('w:num'));\n\n          if (colCount > 1) {\n            var colSpace = parseInt(cols.getAttribute('w:space'));\n            width = width - colSpace * (colCount - 1);\n            width = width / colCount;\n          }\n\n          while (currentTags.length) {\n            var tag = currentTags.pop();\n            tag.dimensions = {\n              width: width * 635,\n              // convert to EMU\n              height: height * 635 // convert to EMU\n\n            };\n          }\n        }\n      });\n      this.tags.forEach(function (tag) {\n        if (!tag.title) {\n          return;\n        } else if (tag.title[0] === '@') {\n          _this2.parRender(tag);\n        } else {\n          _this2.inlineRender(tag);\n        }\n      });\n    } // Render Tags that only exchange inline content\n\n  }, {\n    key: \"inlineRender\",\n    value: function inlineRender(tag) {\n      var texts = tag.par.textContent.split(\"{\".concat(tag.title, \"}\"));\n      var fullText = texts[0] + Object(_common__WEBPACK_IMPORTED_MODULE_1__[\"escapeText\"])(tag.content) + texts[1];\n      var rs = Array.from(tag.par.querySelectorAll('r'));\n\n      while (rs.length > 1) {\n        rs[0].parentNode.removeChild(rs[0]);\n        rs.shift();\n      }\n\n      var r = rs[0];\n\n      if (fullText.length) {\n        var textAttr = '';\n\n        if (fullText[0] === ' ' || fullText[fullText.length - 1] === ' ') {\n          textAttr += 'xml:space=\"preserve\"';\n        }\n\n        r.innerHTML = \"<w:t \".concat(textAttr, \">\").concat(fullText, \"</w:t>\");\n      } else {\n        r.parentNode.removeChild(r);\n      }\n    } // Render tags that exchange paragraphs\n\n  }, {\n    key: \"parRender\",\n    value: function parRender(tag) {\n      var _this3 = this;\n\n      var pStyle = tag.par.querySelector('pStyle');\n      var options = {\n        dimensions: tag.dimensions,\n        citationType: this.exporter.citations.citFm.citationType,\n        section: pStyle ? pStyle.getAttribute('w:val') : 'Normal'\n      };\n      var outXML = tag.content ? tag.content.map(function (content) {\n        return _this3.exporter.richtext.transformRichtext(content, options);\n      }).join('') : '';\n      tag.par.insertAdjacentHTML('beforebegin', outXML); // sectPr contains information about columns, etc. We need to move this\n      // to the last paragraph we will be adding.\n\n      var sectPr = tag.par.querySelector('sectPr');\n\n      if (sectPr) {\n        var pPr = tag.par.previousElementSibling.querySelector('pPr');\n        pPr.appendChild(sectPr);\n      }\n\n      tag.par.parentNode.removeChild(tag.par);\n    }\n  }]);\n\n  return DocxExporterRender;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/docx/render.js?");

/***/ }),

/***/ "./js/modules/exporter/docx/richtext.js":
/*!**********************************************!*\
  !*** ./js/modules/exporter/docx/richtext.js ***!
  \**********************************************/
/*! exports provided: DocxExporterRichtext */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DocxExporterRichtext\", function() { return DocxExporterRichtext; });\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\n/* harmony import */ var _schema_i18n__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../schema/i18n */ \"./js/modules/schema/i18n.js\");\nfunction _templateObject20() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:p>\\n                        <w:pPr>\\n                            <w:pStyle w:val=\\\"\", \"\\\"/>\\n                            <w:rPr></w:rPr>\\n                        </w:pPr>\"]);\n\n  _templateObject20 = function _templateObject20() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject19() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:tc>\\n                        <w:tcPr>\\n                            \", \"\\n                            \", \"\\n                            \", \"\\n                        </w:tcPr>\\n                        \", \"\"]);\n\n  _templateObject19 = function _templateObject19() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject18() {\n  var data = _taggedTemplateLiteral([\"<w:tblW w:w=\\\"\", \"\\\" w:type=\\\"pct\\\" />\\n                                    <w:jc w:val=\\\"\", \"\\\" />\"]);\n\n  _templateObject18 = function _templateObject18() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject17() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:tbl>\\n                        <w:tblPr>\\n                            <w:tblStyle w:val=\\\"\", \"\\\" />\\n                            \", \"\\n                            <w:tblLook w:val=\\\"04A0\\\" w:firstRow=\\\"1\\\" w:lastRow=\\\"0\\\" w:firstColumn=\\\"1\\\" w:lastColumn=\\\"0\\\" w:noHBand=\\\"0\\\" w:noVBand=\\\"1\\\" />\\n                        </w:tblPr>\\n                        <w:tblGrid>\"]);\n\n  _templateObject17 = function _templateObject17() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject16() {\n  var data = _taggedTemplateLiteral([\"\\n                                                        \", \"\\n                                                        \", \"\\n                                                    </w:p>\\n                                                </w:txbxContent>\\n                                            </wps:txbx>\\n                                            <wps:bodyPr anchor=\\\"t\\\" lIns=\\\"0\\\" tIns=\\\"0\\\" rIns=\\\"0\\\" bIns=\\\"0\\\">\\n                                                <a:noAutofit />\\n                                            </wps:bodyPr>\\n                                        </wps:wsp>\\n                                    </a:graphicData>\\n                                </a:graphic>\\n                                  <wp14:sizeRelH relativeFrom=\\\"margin\\\">\\n                                    <wp14:pctWidth>\", \"000</wp14:pctWidth>\\n                                </wp14:sizeRelH>\\n                            </wp:anchor>\\n                        </w:drawing>\\n                      </w:r>\\n                    </w:p>\"]);\n\n  _templateObject16 = function _templateObject16() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject15() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:p>\\n                      <w:pPr>\\n                        <w:jc w:val=\\\"center\\\"/>\\n                      </w:pPr>\\n                      <w:r>\\n                        <w:rPr/>\\n                          <w:drawing>\\n                            <wp:anchor behindDoc=\\\"0\\\" distT=\\\"95250\\\" distB=\\\"95250\\\" distL=\\\"95250\\\" distR=\\\"95250\\\" simplePos=\\\"0\\\" locked=\\\"0\\\" layoutInCell=\\\"1\\\" allowOverlap=\\\"0\\\" relativeHeight=\\\"2\\\">\\n                                <wp:simplePos x=\\\"0\\\" y=\\\"0\\\" />\\n                                <wp:positionH relativeFrom=\\\"column\\\">\\n                                    <wp:align>\", \"</wp:align>\\n                                </wp:positionH>\\n                                <wp:positionV relativeFrom=\\\"paragraph\\\">\\n                                    <wp:posOffset>0</wp:posOffset>\\n                                </wp:positionV>\\n                                <wp:extent cx=\\\"\", \"\\\" cy=\\\"\", \"\\\" />\\n                                <wp:effectExtent l=\\\"0\\\" t=\\\"0\\\" r=\\\"0\\\" b=\\\"0\\\" />\\n                                <wp:wrapSquare wrapText=\\\"largest\\\" />\\n                                <wp:docPr id=\\\"\", \"\\\" name=\\\"Frame\", \"\\\" />\\n                                <a:graphic xmlns:a=\\\"http://schemas.openxmlformats.org/drawingml/2006/main\\\">\\n                                    <a:graphicData uri=\\\"http://schemas.microsoft.com/office/word/2010/wordprocessingShape\\\">\\n                                        <wps:wsp>\\n                                            <wps:cNvSpPr txBox=\\\"1\\\" />\\n                                            <wps:spPr>\\n                                                <a:xfrm>\\n                                                    <a:off x=\\\"0\\\" y=\\\"0\\\" />\\n                                                    <a:ext cx=\\\"\", \"\\\" cy=\\\"\", \"\\\" />\\n                                                </a:xfrm>\\n                                                <a:prstGeom prst=\\\"rect\\\" />\\n                                            </wps:spPr>\\n                                            <wps:txbx>\\n                                                <w:txbxContent>\\n                                                    <w:p>\\n                                                        <w:pPr>\\n                                                            <w:pStyle w:val=\\\"Caption\\\" />\\n                                                            <w:spacing w:before=\\\"20\\\" w:after=\\\"220\\\" />\\n                                                            <w:rPr></w:rPr>\\n                                                        </w:pPr>\\n                                                        <w:bookmarkStart w:name=\\\"\", \"\\\" w:id=\\\"\", \"\\\"/>\\n                                                        <w:bookmarkEnd w:id=\\\"\", \"\\\"/>\"]);\n\n  _templateObject15 = function _templateObject15() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject14() {\n  var data = _taggedTemplateLiteral([\"<w:r>\\n                                  <w:rPr></w:rPr>\\n                                  <w:t>\", \"</w:t>\\n                              </w:r>\"]);\n\n  _templateObject14 = function _templateObject14() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject13() {\n  var data = _taggedTemplateLiteral([\"<w:p>\\n                          <w:pPr><w:pStyle w:val=\\\"Caption\\\"/><w:rPr></w:rPr></w:pPr>\\n                          \", \"\\n                          \", \"</w:p>\"]);\n\n  _templateObject13 = function _templateObject13() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject12() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:p>\\n                      <w:pPr>\\n                        <w:jc w:val=\\\"center\\\"/>\\n                      </w:pPr>\\n                      <w:bookmarkStart w:name=\\\"\", \"\\\" w:id=\\\"\", \"\\\"/>\\n                      <w:bookmarkEnd w:id=\\\"\", \"\\\"/>\"]);\n\n  _templateObject12 = function _templateObject12() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject11() {\n  var data = _taggedTemplateLiteral([\"<w:r>\\n                      <w:rPr/>\\n                      <w:drawing>\\n                        <wp:inline distT=\\\"0\\\" distB=\\\"0\\\" distL=\\\"0\\\" distR=\\\"0\\\">\\n                          <wp:extent cx=\\\"\", \"\\\" cy=\\\"\", \"\\\"/>\\n                          <wp:docPr id=\\\"\", \"\\\" name=\\\"Picture\", \"\\\" descr=\\\"\\\"/>\\n                          <a:graphic xmlns:a=\\\"http://schemas.openxmlformats.org/drawingml/2006/main\\\">\\n                            <a:graphicData uri=\\\"http://schemas.openxmlformats.org/drawingml/2006/picture\\\">\\n                              <pic:pic xmlns:pic=\\\"http://schemas.openxmlformats.org/drawingml/2006/picture\\\">\\n                                <pic:nvPicPr>\\n                                  <pic:cNvPr id=\\\"0\\\" name=\\\"\", \"\\\" descr=\\\"\\\"/>\\n                                  <pic:cNvPicPr>\\n                                    <a:picLocks noChangeAspect=\\\"1\\\" noChangeArrowheads=\\\"1\\\"/>\\n                                  </pic:cNvPicPr>\\n                                </pic:nvPicPr>\\n                                <pic:blipFill>\\n                                  <a:blip r:embed=\\\"rId\", \"\\\"/>\\n                                  <a:stretch>\\n                                    <a:fillRect/>\\n                                  </a:stretch>\\n                                </pic:blipFill>\\n                                <pic:spPr bwMode=\\\"auto\\\">\\n                                  <a:xfrm>\\n                                    <a:off x=\\\"0\\\" y=\\\"0\\\"/>\\n                                    <a:ext cx=\\\"\", \"\\\" cy=\\\"\", \"\\\"/>\\n                                  </a:xfrm>\\n                                  <a:prstGeom prst=\\\"rect\\\">\\n                                    <a:avLst/>\\n                                  </a:prstGeom>\\n                                  <a:noFill/>\\n                                  <a:ln w=\\\"9525\\\">\\n                                    <a:noFill/>\\n                                    <a:miter lim=\\\"800000\\\"/>\\n                                    <a:headEnd/>\\n                                    <a:tailEnd/>\\n                                  </a:ln>\\n                                </pic:spPr>\\n                              </pic:pic>\\n                            </a:graphicData>\\n                          </a:graphic>\\n                        </wp:inline>\\n                      </w:drawing>\\n                    </w:r>\"]);\n\n  _templateObject11 = function _templateObject11() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject10() {\n  var data = _taggedTemplateLiteral([\"\\n                        <w:r>\\n                            <w:rPr>\\n                                <w:rStyle w:val=\\\"FootnoteAnchor\\\"/>\\n                            </w:rPr>\\n                            <w:footnoteReference w:id=\\\"\", \"\\\"/>\\n                        </w:r>\"]);\n\n  _templateObject10 = function _templateObject10() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:r>\\n                        <w:rPr>\\n                            <w:rStyle w:val=\\\"FootnoteAnchor\\\"/>\\n                        </w:rPr>\\n                        <w:footnoteReference w:id=\\\"\", \"\\\"/>\\n                    </w:r>\"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:p>\\n                        <w:pPr>\\n                            <w:pStyle w:val=\\\"Heading6\\\"/>\\n                            <w:rPr></w:rPr>\\n                        </w:pPr>\\n                        <w:bookmarkStart w:name=\\\"\", \"\\\" w:id=\\\"\", \"\\\"/>\\n                        <w:bookmarkEnd w:id=\\\"\", \"\\\"/>\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:p>\\n                        <w:pPr>\\n                            <w:pStyle w:val=\\\"Heading5\\\"/>\\n                            <w:rPr></w:rPr>\\n                        </w:pPr>\\n                        <w:bookmarkStart w:name=\\\"\", \"\\\" w:id=\\\"\", \"\\\"/>\\n                        <w:bookmarkEnd w:id=\\\"\", \"\\\"/>\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:p>\\n                        <w:pPr>\\n                            <w:pStyle w:val=\\\"Heading4\\\"/>\\n                            <w:rPr></w:rPr>\\n                        </w:pPr>\\n                        <w:bookmarkStart w:name=\\\"\", \"\\\" w:id=\\\"\", \"\\\"/>\\n                        <w:bookmarkEnd w:id=\\\"\", \"\\\"/>\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:p>\\n                        <w:pPr>\\n                            <w:pStyle w:val=\\\"Heading3\\\"/>\\n                            <w:rPr></w:rPr>\\n                        </w:pPr>\\n                        <w:bookmarkStart w:name=\\\"\", \"\\\" w:id=\\\"\", \"\\\"/>\\n                        <w:bookmarkEnd w:id=\\\"\", \"\\\"/>\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:p>\\n                        <w:pPr>\\n                            <w:pStyle w:val=\\\"Heading2\\\"/>\\n                            <w:rPr></w:rPr>\\n                        </w:pPr>\\n                        <w:bookmarkStart w:name=\\\"\", \"\\\" w:id=\\\"\", \"\\\"/>\\n                        <w:bookmarkEnd w:id=\\\"\", \"\\\"/>\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:p>\\n                        <w:pPr>\\n                            <w:pStyle w:val=\\\"Heading1\\\"/>\\n                            <w:rPr></w:rPr>\\n                        </w:pPr>\\n                        <w:bookmarkStart w:name=\\\"\", \"\\\" w:id=\\\"\", \"\\\"/>\\n                        <w:bookmarkEnd w:id=\\\"\", \"\\\"/>\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n                    <w:p>\\n                        <w:pPr>\\n                            <w:pStyle w:val=\\\"BibliographyHeading\\\"/>\\n                            <w:rPr></w:rPr>\\n                        </w:pPr>\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n                        <w:p>\\n                            <w:pPr><w:pStyle w:val=\\\"\", \"\\\"/>\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar DocxExporterRichtext =\n/*#__PURE__*/\nfunction () {\n  function DocxExporterRichtext(exporter, rels, citations, images) {\n    _classCallCheck(this, DocxExporterRichtext);\n\n    this.exporter = exporter;\n    this.rels = rels;\n    this.citations = citations;\n    this.images = images;\n    this.fnCounter = 2; // footnotes 0 and 1 are occupied by separators by default.\n\n    this.bookmarkCounter = 0;\n    this.figureCounter = {}; // counters for each type of figure (figure/table/photo)\n\n    this.docPrCount = 0;\n  }\n\n  _createClass(DocxExporterRichtext, [{\n    key: \"transformRichtext\",\n    value: function transformRichtext(node) {\n      var _this = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var start = '',\n          content = '',\n          end = '';\n\n      switch (node.type) {\n        case 'paragraph':\n          if (!options.section) {\n            options.section = 'Normal';\n          } // This should really be something like\n          // '<w:p w:rsidR=\"A437D321\" w:rsidRDefault=\"2B935ADC\">'\n          // See: https://blogs.msdn.microsoft.com/brian_jones/2006/12/11/whats-up-with-all-those-rsids/\n          // But tests with Word 2016/LibreOffice seem to indicate that it\n          // doesn't care if the attributes are missing.\n          // We may need to add them later, if it turns out this is a problem\n          // for other versions of Word. In that case we should also add\n          // it to settings.xml as described in above link.\n\n\n          if (options.section === 'Normal' && !options.list_type && !(node.content && node.content.length)) {\n            start += '<w:p/>';\n          } else {\n            start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject(), options.section);\n\n            if (options.list_type) {\n              start += \"<w:numPr><w:ilvl w:val=\\\"\".concat(options.list_depth, \"\\\"/>\");\n              start += \"<w:numId w:val=\\\"\".concat(options.list_type, \"\\\"/></w:numPr>\");\n            } else {\n              start += '<w:rPr></w:rPr>';\n            }\n\n            start += '</w:pPr>';\n            end = '</w:p>' + end;\n          }\n\n          break;\n\n        case 'bibliography_heading':\n          start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject2());\n          end = '</w:p>' + end;\n          break;\n\n        case 'heading1':\n          start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject3(), node.attrs.id, this.bookmarkCounter, this.bookmarkCounter++);\n          end = '</w:p>' + end;\n          break;\n\n        case 'heading2':\n          start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject4(), node.attrs.id, this.bookmarkCounter, this.bookmarkCounter++);\n          end = '</w:p>' + end;\n          break;\n\n        case 'heading3':\n          start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject5(), node.attrs.id, this.bookmarkCounter, this.bookmarkCounter++);\n          end = '</w:p>' + end;\n          break;\n\n        case 'heading4':\n          start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject6(), node.attrs.id, this.bookmarkCounter, this.bookmarkCounter++);\n          end = '</w:p>' + end;\n          break;\n\n        case 'heading5':\n          start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject7(), node.attrs.id, this.bookmarkCounter, this.bookmarkCounter++);\n          end = '</w:p>' + end;\n          break;\n\n        case 'heading6':\n          start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject8(), node.attrs.id, this.bookmarkCounter, this.bookmarkCounter++);\n          end = '</w:p>' + end;\n          break;\n\n        case 'code':\n          start += '<w:p>';\n          start += '<w:pPr><w:pStyle w:val=\"Code\"/><w:rPr></w:rPr></w:pPr>';\n          end = '</w:p>' + end;\n          break;\n\n        case 'blockquote':\n          // This is imperfect, but Word doesn't seem to provide section/quotation nesting\n          options = Object.assign({}, options);\n          options.section = 'Quote';\n          break;\n\n        case 'ordered_list':\n          options = Object.assign({}, options);\n          options.section = 'ListParagraph';\n          options.list_type = this.exporter.lists.getNumberedType();\n\n          if (options.list_depth === undefined) {\n            options.list_depth = 0;\n          } else {\n            options.list_depth += 1;\n          }\n\n          break;\n\n        case 'bullet_list':\n          options = Object.assign({}, options);\n          options.section = 'ListParagraph';\n          options.list_type = this.exporter.lists.getBulletType();\n\n          if (options.list_depth === undefined) {\n            options.list_depth = 0;\n          } else {\n            options.list_depth += 1;\n          }\n\n          break;\n\n        case 'list_item':\n          // Word seems to lack complex nesting options. The styling is applied\n          // to child paragraphs. This will deliver correct results in most\n          // cases.\n          break;\n\n        case 'footnotecontainer':\n          options = Object.assign({}, options);\n          options.section = 'Footnote';\n          start += \"<w:footnote w:id=\\\"\".concat(this.fnCounter++, \"\\\">\");\n          end = '</w:footnote>' + end;\n          options.footnoteRefMissing = true;\n          break;\n\n        case 'footnote':\n          content += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject9(), this.fnCounter++);\n          break;\n\n        case 'text':\n          {\n            var hyperlink, em, strong, underline, smallcaps, sup, sub; // Check for hyperlink, bold/strong and italic/em\n\n            if (node.marks) {\n              hyperlink = node.marks.find(function (mark) {\n                return mark.type === 'link';\n              });\n              em = node.marks.find(function (mark) {\n                return mark.type === 'em';\n              });\n              strong = node.marks.find(function (mark) {\n                return mark.type === 'strong';\n              });\n              underline = node.marks.find(function (mark) {\n                return mark.type === 'underline';\n              });\n              smallcaps = node.marks.find(function (mark) {\n                return mark.type === 'smallcaps';\n              });\n              sup = node.marks.find(function (mark) {\n                return mark.type === 'sup';\n              });\n              sub = node.marks.find(function (mark) {\n                return mark.type === 'sub';\n              });\n            }\n\n            if (hyperlink) {\n              var href = hyperlink.attrs.href;\n\n              if (href[0] === '#') {\n                // Internal link\n                start += \"<w:hyperlink w:anchor=\\\"\".concat(href.slice(1), \"\\\">\");\n              } else {\n                // External link\n                var refId = this.rels.addLinkRel(href);\n                start += \"<w:hyperlink r:id=\\\"rId\".concat(refId, \"\\\">\");\n              }\n\n              start += '<w:r>';\n              end = '</w:t></w:r></w:hyperlink>' + end;\n            } else {\n              start += '<w:r>';\n              end = '</w:t></w:r>' + end;\n            }\n\n            if (hyperlink || em || strong || underline || smallcaps || sup || sub) {\n              start += '<w:rPr>';\n\n              if (hyperlink) {\n                start += '<w:rStyle w:val=\"Hyperlink\"/>';\n              }\n\n              if (em) {\n                start += '<w:i/><w:iCs/>';\n              }\n\n              if (strong) {\n                start += '<w:b/><w:bCs/>';\n              }\n\n              if (underline) {\n                start += '<w:u w:val=\"single\"/>';\n              }\n\n              if (smallcaps) {\n                start += '<w:smallCaps/>';\n              }\n\n              if (sup) {\n                start += '<w:vertAlign w:val=\"superscript\"/>';\n              } else if (sub) {\n                start += '<w:vertAlign w:val=\"subscript\"/>';\n              }\n\n              start += '</w:rPr>';\n            }\n\n            if (options.footnoteRefMissing) {\n              start += '<w:footnoteRef /><w:tab />';\n              options.footnoteRefMissing = false;\n            }\n\n            var textAttr = '';\n\n            if (node.text[0] === ' ' || node.text[node.text.length - 1] === ' ') {\n              textAttr += 'xml:space=\"preserve\"';\n            }\n\n            start += \"<w:t \".concat(textAttr, \">\");\n            content += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"escapeText\"])(node.text);\n            break;\n          }\n\n        case 'citation':\n          {\n            // We take the first citation from the stack and remove it.\n            var cit = this.citations.pmCits.shift();\n\n            if (options.citationType && options.citationType === 'note') {\n              // If the citations are in notes (footnotes), we need to\n              // put the contents of this citation in a footnote.\n              // We then add the footnote to the footnote file and\n              // adjust the ids of all subsequent footnotes to be one higher\n              // than what they were until now.\n              content += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject10(), this.fnCounter);\n              var fnContents = this.transformRichtext(cit, {\n                footnoteRefMissing: true,\n                section: 'Footnote'\n              });\n              var fnXml = \"<w:footnote w:id=\\\"\".concat(this.fnCounter, \"\\\">\").concat(fnContents, \"</w:footnote>\");\n              var xml = this.exporter.footnotes.xml;\n              var lastId = this.fnCounter - 1;\n              var footnotes = xml.querySelectorAll('footnote');\n              footnotes.forEach(function (footnote) {\n                var id = parseInt(footnote.getAttribute('w:id'));\n\n                if (id >= _this.fnCounter) {\n                  footnote.setAttribute('w:id', id + 1);\n                }\n\n                if (id === lastId) {\n                  footnote.insertAdjacentHTML('afterend', fnXml);\n                }\n              });\n              this.fnCounter++;\n            } else {\n              for (var i = 0; i < cit.content.length; i++) {\n                content += this.transformRichtext(cit.content[i], options);\n              }\n            }\n\n            break;\n          }\n\n        case 'figure':\n          {\n            var figCat = node.attrs.figureCategory;\n            var caption = Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"escapeText\"])(node.attrs.caption);\n            var figCountXml = '';\n\n            if (figCat !== 'none') {\n              if (!this.figureCounter[figCat]) {\n                this.figureCounter[figCat] = 1;\n              }\n\n              figCountXml = \"<w:r>\\n                        <w:t xml:space=\\\"preserve\\\">\".concat(_schema_i18n__WEBPACK_IMPORTED_MODULE_1__[\"FIG_CATS\"][node.attrs.figureCategory][this.exporter.doc.settings.language], \" </w:t>\\n                    </w:r>\\n                    <w:r>\\n                        <w:rPr></w:rPr>\\n                        <w:fldChar w:fldCharType=\\\"begin\\\"></w:fldChar>\\n                    </w:r>\\n                    <w:r>\\n                        <w:rPr></w:rPr>\\n                        <w:instrText> SEQ \").concat(node.attrs.figureCategory, \" \\\\* ARABIC </w:instrText>\\n                    </w:r>\\n                    <w:r>\\n                        <w:rPr></w:rPr>\\n                        <w:fldChar w:fldCharType=\\\"separate\\\" />\\n                    </w:r>\\n                    <w:r>\\n                        <w:rPr></w:rPr>\\n                        <w:t>\").concat(this.figureCounter[figCat]++, \"</w:t>\\n                    </w:r>\\n                    <w:r>\\n                        <w:rPr></w:rPr>\\n                        <w:fldChar w:fldCharType=\\\"end\\\" />\\n                    </w:r>\");\n              caption = caption.length ? ': ' + caption : '';\n            }\n\n            var cx, cy;\n\n            if (node.attrs.image !== false) {\n              var imgDBEntry = this.images.imageDB.db[node.attrs.image];\n              cx = imgDBEntry.width * 9525; // width in EMU\n\n              cy = imgDBEntry.height * 9525; // height in EMU\n\n              var imgTitle = imgDBEntry.title; // Shrink image if too large for paper.\n\n              if (options.dimensions) {\n                var width = options.dimensions.width;\n\n                if (options.tableSideMargins) {\n                  width = width - options.tableSideMargins;\n                }\n\n                width = width * parseInt(node.attrs.width) / 100;\n\n                if (cx > width) {\n                  var rel = cy / cx;\n                  cx = width;\n                  cy = cx * rel;\n                }\n\n                if (cy > options.dimensions.height) {\n                  var _rel = cx / cy;\n\n                  cy = options.dimensions.height;\n                  cx = cy * _rel;\n                }\n              }\n\n              cy = Math.round(cy);\n              cx = Math.round(cx);\n              var rId = this.images.imgIdTranslation[node.attrs.image];\n              content += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject11(), cx, cy, this.docPrCount, this.docPrCount++, imgTitle, rId, cx, cy);\n            } else {\n              cx = 9525 * 100; // We pick a random size of 100x100. We hope this will fit the formula\n\n              cy = 9525 * 100;\n              var latex = node.attrs.equation;\n              content += this.exporter.math.getOmml(latex);\n            }\n\n            var captionSpace = !!(figCountXml.length || caption.length);\n\n            if (node.attrs.aligned === 'center') {\n              start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject12(), node.attrs.id, this.bookmarkCounter, this.bookmarkCounter++);\n              end = \"\\n                    </w:p>\\n                    \".concat(captionSpace ? Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject13(), figCountXml, caption.length ? Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject14(), caption) : '') : '') + end;\n            } else {\n              start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject15(), node.attrs.aligned, cx, captionSpace ? cy + 350520 : cy, this.docPrCount, this.docPrCount++, cx, captionSpace ? cy + 350520 : cy, node.attrs.id, this.bookmarkCounter, this.bookmarkCounter++);\n              end = Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject16(), figCountXml, caption.length ? \"<w:r>\\n                                                                <w:rPr></w:rPr>\\n                                                                <w:t>\".concat(caption, \"</w:t>\\n                                                            </w:r>\") : '', node.attrs.width) + end;\n            }\n\n            break;\n          }\n\n        case 'table':\n          {\n            this.exporter.tables.addTableGridStyle();\n            start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject17(), this.exporter.tables.tableGridStyle, node.attrs.width === '100' ? '<w:tblW w:w=\"0\" w:type=\"auto\" />' : Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject18(), 50 * parseInt(node.attrs.width), node.attrs.aligned));\n            var columns = node.content[0].content.length;\n            var cellWidth = 63500; // standard width\n\n            options = Object.assign({}, options);\n\n            if (options.dimensions && options.dimensions.width) {\n              cellWidth = parseInt(options.dimensions.width / columns) - 2540; // subtracting for border width\n            } else if (!options.dimensions) {\n              options.dimensions = {};\n            }\n\n            options.dimensions = Object.assign({}, options.dimensions);\n            options.dimensions.width = cellWidth;\n            options.tableSideMargins = this.exporter.tables.getSideMargins();\n\n            for (var _i = 0; _i < columns; _i++) {\n              start += \"<w:gridCol w:w=\\\"\".concat(parseInt(cellWidth / 635), \"\\\" />\");\n            }\n\n            start += '</w:tblGrid>';\n            end = '</w:tbl>' + end;\n            break;\n          }\n\n        case 'table_row':\n          start += '<w:tr>';\n          end = '</w:tr>' + end;\n          break;\n\n        case 'table_cell':\n        case 'table_header':\n          start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject19(), node.attrs.rowspan && node.attrs.colspan ? \"<w:tcW w:w=\\\"\".concat(parseInt(options.dimensions.width / 635), \"\\\" w:type=\\\"dxa\\\" />\") : '<w:tcW w:w=\"0\" w:type=\"auto\" />', node.attrs.rowspan ? node.attrs.rowspan > 1 ? '<w:vMerge w:val=\"restart\" />' : '' : '<w:vMerge/>', node.attrs.colspan ? node.attrs.colspan > 1 ? '<w:hMerge w:val=\"restart\" />' : '' : '<w:hMerge/>', node.content ? '' : '<w:p/>');\n          end = '</w:tc>' + end;\n          break;\n\n        case 'equation':\n          {\n            var _latex = node.attrs.equation;\n            content += this.exporter.math.getOmml(_latex);\n            break;\n          }\n\n        case 'hard_break':\n          content += '<w:r><w:br/></w:r>';\n          break;\n        // CSL bib entries\n\n        case 'cslbib':\n          options = Object.assign({}, options);\n          options.section = 'Bibliography1';\n          break;\n\n        case 'cslblock':\n          end = '<w:r><w:br/></w:r>' + end;\n          break;\n\n        case 'cslleftmargin':\n          end = '<w:r><w:tab/></w:r>' + end;\n          break;\n\n        case 'cslindent':\n          start += '<w:r><w:tab/></w:r>';\n          end = '<w:r><w:br/></w:r>' + end;\n          break;\n\n        case 'cslentry':\n          start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject20(), options.section);\n          end = '</w:p>' + end;\n          break;\n\n        case 'cslinline':\n        case 'cslrightinline':\n          break;\n\n        default:\n          break;\n      }\n\n      if (node.content) {\n        for (var _i2 = 0; _i2 < node.content.length; _i2++) {\n          content += this.transformRichtext(node.content[_i2], options);\n        }\n      }\n\n      return start + content + end;\n    }\n  }]);\n\n  return DocxExporterRichtext;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/docx/richtext.js?");

/***/ }),

/***/ "./js/modules/exporter/docx/tables.js":
/*!********************************************!*\
  !*** ./js/modules/exporter/docx/tables.js ***!
  \********************************************/
/*! exports provided: DocxExporterTables */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DocxExporterTables\", function() { return DocxExporterTables; });\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    <w:style w:type=\\\"table\\\" w:styleId=\\\"TableGrid\\\">\\n        <w:name w:val=\\\"Table Grid\\\"/>\\n        <w:basedOn w:val=\\\"\", \"\\\"/>\\n        <w:uiPriority w:val=\\\"39\\\"/>\\n        <w:pPr>\\n            <w:spacing w:after=\\\"0\\\" w:line=\\\"240\\\" w:lineRule=\\\"auto\\\"/>\\n        </w:pPr>\\n        <w:tblPr>\\n            <w:hMerge/>\\n            <w:vMerge/>\\n            <w:tblBorders>\\n                <w:top w:val=\\\"single\\\" w:sz=\\\"4\\\" w:space=\\\"0\\\" w:color=\\\"auto\\\"/>\\n                <w:left w:val=\\\"single\\\" w:sz=\\\"4\\\" w:space=\\\"0\\\" w:color=\\\"auto\\\"/>\\n                <w:bottom w:val=\\\"single\\\" w:sz=\\\"4\\\" w:space=\\\"0\\\" w:color=\\\"auto\\\"/>\\n                <w:right w:val=\\\"single\\\" w:sz=\\\"4\\\" w:space=\\\"0\\\" w:color=\\\"auto\\\"/>\\n                <w:insideH w:val=\\\"single\\\" w:sz=\\\"4\\\" w:space=\\\"0\\\" w:color=\\\"auto\\\"/>\\n                <w:insideV w:val=\\\"single\\\" w:sz=\\\"4\\\" w:space=\\\"0\\\" w:color=\\\"auto\\\"/>\\n\\n            </w:tblBorders>\\n        </w:tblPr>\\n\\n\\n    </w:style>\\n    \"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    <w:style w:type=\\\"table\\\" w:default=\\\"1\\\" w:styleId=\\\"TableNormal\\\">\\n        <w:name w:val=\\\"Normal Table\\\"/>\\n        <w:uiPriority w:val=\\\"99\\\"/>\\n        <w:semiHidden/>\\n        <w:unhideWhenUsed/>\\n        <w:tblPr>\\n          <w:tblInd w:w=\\\"0\\\" w:type=\\\"dxa\\\"/>\\n          <w:tblCellMar>\\n            <w:top w:w=\\\"0\\\" w:type=\\\"dxa\\\"/>\\n            <w:left w:w=\\\"108\\\" w:type=\\\"dxa\\\"/>\\n            <w:bottom w:w=\\\"0\\\" w:type=\\\"dxa\\\"/>\\n            <w:right w:w=\\\"108\\\" w:type=\\\"dxa\\\"/>\\n          </w:tblCellMar>\\n        </w:tblPr>\\n    </w:style>\\n    \"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\n\nvar DEFAULT_TABLENORMAL_XML = Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject());\n\nvar DEFAULT_TABLEGRID_XML = function DEFAULT_TABLEGRID_XML(tableNormalStyle) {\n  return Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject2(), tableNormalStyle);\n};\n\nvar DocxExporterTables =\n/*#__PURE__*/\nfunction () {\n  function DocxExporterTables(exporter) {\n    _classCallCheck(this, DocxExporterTables);\n\n    this.exporter = exporter;\n    this.sideMargins = false;\n    this.tableGridStyle = false;\n    this.tableNormalStyle = false;\n    this.styleXml = false;\n    this.styleFilePath = 'word/styles.xml';\n  }\n\n  _createClass(DocxExporterTables, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.exporter.xml.getXml(this.styleFilePath).then(function (styleXml) {\n        _this.styleXml = styleXml;\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"addTableNormalStyle\",\n    value: function addTableNormalStyle() {\n      if (this.tableNormalStyle) {\n        // already added\n        return;\n      }\n\n      var tableNormalEl = this.styleXml.querySelector(\"style[*|type=\\\"table\\\"][*|default=\\\"1\\\"]\");\n\n      if (tableNormalEl) {\n        this.tableNormalStyle = tableNormalEl.getAttribute('w:styleId');\n      } else {\n        var stylesEl = this.styleXml.querySelector('styles');\n        stylesEl.insertAdjacentHTML('beforeEnd', DEFAULT_TABLENORMAL_XML);\n        this.tableNormalStyle = 'TableNormal';\n      }\n    }\n  }, {\n    key: \"addTableGridStyle\",\n    value: function addTableGridStyle() {\n      if (this.tableGridStyle) {\n        // already added\n        return;\n      }\n\n      this.addTableNormalStyle();\n      var tableGridEl = this.styleXml.querySelector('style[*|type=\"table\"][*|customStyle=\"1\"]');\n\n      if (tableGridEl) {\n        this.tableGridStyle = tableGridEl.getAttribute('w:styleId');\n      } else {\n        var stylesEl = this.styleXml.querySelector('styles');\n        stylesEl.insertAdjacentHTML('beforeEnd', DEFAULT_TABLEGRID_XML(this.tableNormalStyle));\n        this.tableGridStyle = 'TableGrid';\n      }\n    }\n  }, {\n    key: \"getSideMargins\",\n    value: function getSideMargins() {\n      if (!this.sideMargins) {\n        var marginsEl = this.styleXml.querySelector(\"style[*|styleId=\\\"\".concat(this.tableGridStyle, \"\\\"]\"));\n        var leftEl = marginsEl.querySelector('left');\n        var rightEl = marginsEl.querySelector('right');\n        var left = parseInt(leftEl.getAttribute('w:w'));\n        var right = parseInt(rightEl.getAttribute('w:w'));\n        this.sideMargins = (left + right) * 635;\n      }\n\n      return this.sideMargins;\n    }\n  }]);\n\n  return DocxExporterTables;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/docx/tables.js?");

/***/ })

}]);