(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[16],{

/***/ "./js/modules/exporter/odt/citations.js":
/*!**********************************************!*\
  !*** ./js/modules/exporter/odt/citations.js ***!
  \**********************************************/
/*! exports provided: OdtExporterCitations */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"OdtExporterCitations\", function() { return OdtExporterCitations; });\n/* harmony import */ var prosemirror_model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! prosemirror-model */ \"./node_modules/prosemirror-model/dist/index.js\");\n/* harmony import */ var prosemirror_model__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _citations_format__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../citations/format */ \"./js/modules/citations/format.js\");\n/* harmony import */ var _schema_footnotes__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../schema/footnotes */ \"./js/modules/schema/footnotes.js\");\n/* harmony import */ var _bibliography_schema_csl_bib__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../bibliography/schema/csl_bib */ \"./js/modules/bibliography/schema/csl_bib.js\");\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\nvar OdtExporterCitations =\n/*#__PURE__*/\nfunction () {\n  function OdtExporterCitations(exporter, bibDB, citationStyles, citationLocales, docContents, docTemplate) {\n    var origCitInfos = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : [];\n\n    _classCallCheck(this, OdtExporterCitations);\n\n    this.exporter = exporter;\n    this.bibDB = bibDB;\n    this.citationStyles = citationStyles;\n    this.citationLocales = citationLocales;\n    this.docContents = docContents;\n    this.docTemplate = docTemplate; // If citInfos were found in a previous run, they are stored here\n    // (for example: first citations in main document, then in footnotes)\n\n    this.origCitInfos = origCitInfos;\n    this.citInfos = [];\n    this.citationTexts = [];\n    this.pmCits = [];\n    this.citFm = false;\n    this.pmBib = false;\n  }\n\n  _createClass(OdtExporterCitations, [{\n    key: \"init\",\n    value: function init() {\n      return this.formatCitations();\n    } // Citations are highly interdependent -- so we need to format them all\n    // together before laying out the document.\n\n  }, {\n    key: \"formatCitations\",\n    value: function formatCitations() {\n      var _this = this;\n\n      if (this.origCitInfos.length) {\n        // Initial citInfos are taken from a previous run to include in\n        // bibliography, and they are removed before spitting out the\n        // citation entries for the given document.\n        // That way the bibliography should contain information from both.\n        this.citInfos = this.citInfos.concat(this.origCitInfos);\n      }\n\n      Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_4__[\"descendantNodes\"])(this.docContents).forEach(function (node) {\n        if (node.type === 'citation') {\n          _this.citInfos.push(JSON.parse(JSON.stringify(node.attrs)));\n        }\n      });\n      this.citFm = new _citations_format__WEBPACK_IMPORTED_MODULE_1__[\"FormatCitations\"](this.citInfos, this.exporter.doc.settings.citationstyle, '', this.bibDB, this.citationStyles, this.citationLocales);\n      return this.citFm.init().then(function () {\n        _this.citationTexts = _this.citFm.citationTexts;\n\n        if (_this.origCitInfos.length) {\n          // Remove all citation texts originating from original starting citInfos\n          _this.citationTexts.splice(0, _this.origCitInfos.length);\n        }\n\n        _this.convertCitations();\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"convertCitations\",\n    value: function convertCitations() {\n      // There could be some formatting in the citations, so we parse them through the PM schema for final formatting.\n      // We need to put the citations each in a paragraph so that it works with\n      // the fiduswriter schema and so that the converter doesn't mash them together.\n      if (this.citationTexts.length) {\n        var citationsHTML = '';\n        this.citationTexts.forEach(function (ct) {\n          citationsHTML += \"<p>\".concat(ct, \"</p>\");\n        }); // We create a standard footnote container DOM node,\n        // add the citations into it, and parse it back.\n\n        var fnNode = _schema_footnotes__WEBPACK_IMPORTED_MODULE_2__[\"fnSchema\"].nodeFromJSON({\n          type: 'footnotecontainer'\n        });\n        var serializer = prosemirror_model__WEBPACK_IMPORTED_MODULE_0__[\"DOMSerializer\"].fromSchema(_schema_footnotes__WEBPACK_IMPORTED_MODULE_2__[\"fnSchema\"]);\n        var dom = serializer.serializeNode(fnNode);\n        dom.innerHTML = citationsHTML;\n        this.pmCits = prosemirror_model__WEBPACK_IMPORTED_MODULE_0__[\"DOMParser\"].fromSchema(_schema_footnotes__WEBPACK_IMPORTED_MODULE_2__[\"fnSchema\"]).parse(dom, {\n          topNode: fnNode\n        }).toJSON().content;\n      } else {\n        this.pmCits = [];\n      } // Now we do the same for the bibliography.\n\n\n      var cslBib = this.citFm.bibliography;\n\n      if (cslBib[1].length > 0) {\n        this.exporter.styles.addReferenceStyle(cslBib[0]);\n        var bibNode = _bibliography_schema_csl_bib__WEBPACK_IMPORTED_MODULE_3__[\"cslBibSchema\"].nodeFromJSON({\n          type: 'cslbib'\n        });\n\n        var _serializer = prosemirror_model__WEBPACK_IMPORTED_MODULE_0__[\"DOMSerializer\"].fromSchema(_bibliography_schema_csl_bib__WEBPACK_IMPORTED_MODULE_3__[\"cslBibSchema\"]);\n\n        var _dom = _serializer.serializeNode(bibNode);\n\n        _dom.innerHTML = cslBib[1].join('');\n        this.pmBib = prosemirror_model__WEBPACK_IMPORTED_MODULE_0__[\"DOMParser\"].fromSchema(_bibliography_schema_csl_bib__WEBPACK_IMPORTED_MODULE_3__[\"cslBibSchema\"]).parse(_dom, {\n          topNode: bibNode\n        }).toJSON();\n      }\n    }\n  }]);\n\n  return OdtExporterCitations;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/odt/citations.js?");

/***/ }),

/***/ "./js/modules/exporter/odt/footnotes.js":
/*!**********************************************!*\
  !*** ./js/modules/exporter/odt/footnotes.js ***!
  \**********************************************/
/*! exports provided: OdtExporterFootnotes */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"OdtExporterFootnotes\", function() { return OdtExporterFootnotes; });\n/* harmony import */ var _citations__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./citations */ \"./js/modules/exporter/odt/citations.js\");\n/* harmony import */ var _images__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./images */ \"./js/modules/exporter/odt/images.js\");\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n    <text:notes-configuration text:note-class=\\\"footnote\\\" text:citation-style-name=\\\"Footnote_20_Symbol\\\" text:citation-body-style-name=\\\"Footnote_20_anchor\\\" style:num-format=\\\"1\\\" text:start-value=\\\"0\\\" text:footnotes-position=\\\"page\\\" text:start-numbering-at=\\\"document\\\" />\\n    \"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n    <style:style style:name=\\\"Footnote_20_Symbol\\\" style:display-name=\\\"Footnote Symbol\\\" style:family=\\\"text\\\" />\\n    \"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    <style:style style:name=\\\"Footnote_20_anchor\\\" style:display-name=\\\"Footnote anchor\\\" style:family=\\\"text\\\">\\n        <style:text-properties style:text-position=\\\"super 58%\\\" />\\n    </style:style>\\n    \"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    <style:style style:name=\\\"Footnote\\\" style:family=\\\"paragraph\\\" style:parent-style-name=\\\"Standard\\\" style:class=\\\"extra\\\">\\n        <style:paragraph-properties fo:margin-left=\\\"0.2354in\\\" fo:margin-right=\\\"0in\\\" fo:text-indent=\\\"-0.2354in\\\" style:auto-text-indent=\\\"false\\\" text:number-lines=\\\"false\\\" text:line-number=\\\"0\\\" />\\n        <style:text-properties fo:font-size=\\\"10pt\\\" style:font-size-asian=\\\"10pt\\\" style:font-size-complex=\\\"10pt\\\" />\\n    </style:style>\\n    \"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\n\n\n\n\nvar DEFAULT_STYLE_FOOTNOTE = Object(_common__WEBPACK_IMPORTED_MODULE_2__[\"noSpaceTmp\"])(_templateObject());\nvar DEFAULT_STYLE_FOOTNOTE_ANCHOR = Object(_common__WEBPACK_IMPORTED_MODULE_2__[\"noSpaceTmp\"])(_templateObject2());\nvar DEFAULT_STYLE_FOOTNOTE_SYMBOL = Object(_common__WEBPACK_IMPORTED_MODULE_2__[\"noSpaceTmp\"])(_templateObject3());\nvar DEFAULT_STYLE_FOOTNOTE_CONFIGURATION = Object(_common__WEBPACK_IMPORTED_MODULE_2__[\"noSpaceTmp\"])(_templateObject4());\nvar OdtExporterFootnotes =\n/*#__PURE__*/\nfunction () {\n  function OdtExporterFootnotes(exporter, docContents) {\n    _classCallCheck(this, OdtExporterFootnotes);\n\n    this.exporter = exporter;\n    this.docContents = docContents;\n    this.fnPmJSON = false;\n    this.images = false;\n    this.citations = false;\n    this.footnotes = [];\n    this.styleFilePath = 'styles.xml';\n  }\n\n  _createClass(OdtExporterFootnotes, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      this.findFootnotes();\n\n      if (this.footnotes.length || this.exporter.citations.citFm.citationType === 'note' && this.exporter.citations.citInfos.length) {\n        this.convertFootnotes(); // Include the citinfos from the main document so that they will be\n        // used for calculating the bibliography as well\n\n        this.citations = new _citations__WEBPACK_IMPORTED_MODULE_0__[\"OdtExporterCitations\"](this.exporter, this.exporter.bibDB, this.exporter.citationStyles, this.exporter.citationLocales, this.fnPmJSON, this.exporter.citations.citInfos);\n        this.images = new _images__WEBPACK_IMPORTED_MODULE_1__[\"OdtExporterImages\"](this.exporter, this.exporter.imageDB, this.fnPmJSON);\n        return this.citations.init().then(function () {\n          // Replace the main bibliography with the new one that includes\n          // both citations in main document and in the footnotes.\n          _this.exporter.pmBib = _this.citations.pmBib;\n          return _this.images.init();\n        }).then(function () {\n          return _this.addStyles();\n        });\n      } else {\n        // No footnotes were found.\n        return Promise.resolve();\n      }\n    }\n  }, {\n    key: \"addStyles\",\n    value: function addStyles() {\n      var _this2 = this;\n\n      return this.exporter.xml.getXml(this.styleFilePath).then(function (styleXml) {\n        _this2.styleXml = styleXml;\n\n        _this2.addStyle('Footnote', DEFAULT_STYLE_FOOTNOTE);\n\n        _this2.addStyle('Footnote_20_anchor', DEFAULT_STYLE_FOOTNOTE_ANCHOR);\n\n        _this2.addStyle('Footnote_20_Symbol', DEFAULT_STYLE_FOOTNOTE_SYMBOL);\n\n        _this2.setStyleConfig();\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"addStyle\",\n    value: function addStyle(styleName, xml) {\n      if (!this.styleXml.querySelector(\"style[*|name=\\\"\".concat(styleName, \"\\\"]\"))) {\n        var stylesEl = this.styleXml.querySelector('styles');\n        stylesEl.insertAdjacentHTML('beforeEnd', xml);\n      }\n    }\n  }, {\n    key: \"setStyleConfig\",\n    value: function setStyleConfig() {\n      var oldFnStyleConfigEl = this.styleXml.querySelector('notes-configuration[*|note-class=\"footnote\"]');\n\n      if (oldFnStyleConfigEl) {\n        oldFnStyleConfigEl.parentNode.removeChild(oldFnStyleConfigEl);\n      }\n\n      var stylesEl = this.styleXml.querySelector('styles');\n      stylesEl.insertAdjacentHTML('beforeEnd', DEFAULT_STYLE_FOOTNOTE_CONFIGURATION);\n    }\n  }, {\n    key: \"findFootnotes\",\n    value: function findFootnotes() {\n      var _this3 = this;\n\n      Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_3__[\"descendantNodes\"])(this.docContents).forEach(function (node) {\n        if (node.type === 'footnote') {\n          _this3.footnotes.push(node.attrs.footnote);\n        }\n      });\n    }\n  }, {\n    key: \"convertFootnotes\",\n    value: function convertFootnotes() {\n      var fnContent = [];\n      this.footnotes.forEach(function (footnote) {\n        fnContent.push({\n          type: 'footnotecontainer',\n          content: footnote\n        });\n      });\n      this.fnPmJSON = {\n        type: 'doc',\n        content: fnContent\n      };\n    }\n  }]);\n\n  return OdtExporterFootnotes;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/odt/footnotes.js?");

/***/ }),

/***/ "./js/modules/exporter/odt/images.js":
/*!*******************************************!*\
  !*** ./js/modules/exporter/odt/images.js ***!
  \*******************************************/
/*! exports provided: OdtExporterImages */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"OdtExporterImages\", function() { return OdtExporterImages; });\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\nvar OdtExporterImages =\n/*#__PURE__*/\nfunction () {\n  function OdtExporterImages(exporter, imageDB, docContents) {\n    _classCallCheck(this, OdtExporterImages);\n\n    this.exporter = exporter;\n    this.imageDB = imageDB;\n    this.docContents = docContents;\n    this.imgIdTranslation = {};\n    this.manifestXml = false;\n  }\n\n  _createClass(OdtExporterImages, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.exporter.xml.getXml(\"META-INF/manifest.xml\").then(function (manifestXml) {\n        _this.manifestXml = manifestXml;\n        return _this.exportImages();\n      });\n    } // add an image to the list of files\n\n  }, {\n    key: \"addImage\",\n    value: function addImage(imgFileName, image) {\n      imgFileName = this.addFileToManifest(imgFileName);\n      this.exporter.xml.addExtraFile(\"Pictures/\".concat(imgFileName), image);\n      return imgFileName;\n    } // add a an image file to the manifest\n\n  }, {\n    key: \"addFileToManifest\",\n    value: function addFileToManifest(imgFileName) {\n      var fileNameParts = imgFileName.split('.');\n      var fileNameEnding = fileNameParts.pop();\n      var fileNameStart = fileNameParts.join('.');\n      var manifestEl = this.manifestXml.querySelector('manifest');\n      var imgManifest = manifestEl.querySelector(\"file-entry[*|full-path=\\\"Pictures/\".concat(imgFileName, \"\\\"]\"));\n      var counter = 0;\n\n      while (imgManifest) {\n        // Name exists already, we change the name until we get a file name not yet included in manifest.\n        imgFileName = \"\".concat(fileNameStart, \"_\").concat(counter++, \".\").concat(fileNameEnding);\n        imgManifest = manifestEl.querySelector(\"file-entry[*|full-path=\\\"Pictures/\".concat(imgFileName, \"\\\"]\"));\n      }\n\n      var string = \"  <manifest:file-entry manifest:full-path=\\\"Pictures/\".concat(imgFileName, \"\\\" manifest:media-type=\\\"image/\").concat(fileNameEnding, \"\\\"/>\");\n      manifestEl.insertAdjacentHTML('beforeEnd', string);\n      return imgFileName;\n    } // Find all images used in file and add these to the export zip.\n    // TODO: This will likely fail on image types odt doesn't support such as\n    // SVG. Try out and fix.\n\n  }, {\n    key: \"exportImages\",\n    value: function exportImages() {\n      var _this2 = this;\n\n      var usedImgs = [];\n      Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__[\"descendantNodes\"])(this.docContents).forEach(function (node) {\n        if (node.type === 'figure' && node.attrs.image !== false) {\n          if (!(node.attrs.image in usedImgs)) {\n            usedImgs.push(node.attrs.image);\n          }\n        }\n      });\n      return new Promise(function (resolveExportImages) {\n        var p = [];\n        usedImgs.forEach(function (image) {\n          var imgDBEntry = _this2.imageDB.db[image];\n          p.push(new Promise(function (resolve) {\n            __webpack_require__.e(/*! import() */ 1).then(__webpack_require__.t.bind(null, /*! jszip-utils */ \"./node_modules/jszip-utils/lib/index.js\", 7)).then(function (_ref) {\n              var JSZipUtils = _ref[\"default\"];\n              return JSZipUtils.getBinaryContent(imgDBEntry.image, function (err, imageFile) {\n                var wImgId = _this2.addImage(imgDBEntry.image.split('/').pop(), imageFile);\n\n                _this2.imgIdTranslation[image] = wImgId;\n                resolve();\n              });\n            });\n          }));\n        });\n        Promise.all(p).then(function () {\n          return resolveExportImages();\n        });\n      });\n    }\n  }]);\n\n  return OdtExporterImages;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/odt/images.js?");

/***/ }),

/***/ "./js/modules/exporter/odt/index.js":
/*!******************************************!*\
  !*** ./js/modules/exporter/odt/index.js ***!
  \******************************************/
/*! exports provided: OdtExporter */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"OdtExporter\", function() { return OdtExporter; });\n/* harmony import */ var _tools_file__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../tools/file */ \"./js/modules/exporter/tools/file.js\");\n/* harmony import */ var _tools_xml_zip__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../tools/xml_zip */ \"./js/modules/exporter/tools/xml_zip.js\");\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\n/* harmony import */ var _citations__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./citations */ \"./js/modules/exporter/odt/citations.js\");\n/* harmony import */ var _images__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./images */ \"./js/modules/exporter/odt/images.js\");\n/* harmony import */ var _render__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./render */ \"./js/modules/exporter/odt/render.js\");\n/* harmony import */ var _richtext__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./richtext */ \"./js/modules/exporter/odt/richtext.js\");\n/* harmony import */ var _footnotes__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./footnotes */ \"./js/modules/exporter/odt/footnotes.js\");\n/* harmony import */ var _metadata__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./metadata */ \"./js/modules/exporter/odt/metadata.js\");\n/* harmony import */ var _styles__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./styles */ \"./js/modules/exporter/odt/styles.js\");\n/* harmony import */ var _math__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./math */ \"./js/modules/exporter/odt/math.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\n\n\n\n\n\n\n\n\n/*\nExporter to Open Document Text (LibreOffice)\n*/\n\n/*\nTODO:\n* - Export comments\n* - Templating of tag/contributor output\n*/\n\nvar OdtExporter =\n/*#__PURE__*/\nfunction () {\n  function OdtExporter(doc, templateUrl, bibDB, imageDB, citationStyles, citationLocales) {\n    _classCallCheck(this, OdtExporter);\n\n    this.doc = doc;\n    this.templateUrl = templateUrl;\n    this.bibDB = bibDB;\n    this.imageDB = imageDB;\n    this.citationStyles = citationStyles;\n    this.citationLocales = citationLocales;\n    this.pmCits = false;\n    this.docContents = false;\n    this.docTitle = false;\n  }\n\n  _createClass(OdtExporter, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      this.docContents = Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_2__[\"fixTables\"])(Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_2__[\"removeHidden\"])(this.doc.contents));\n      this.docTitle = Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_2__[\"textContent\"])(this.docContents.content[0]);\n      this.metadata = new _metadata__WEBPACK_IMPORTED_MODULE_8__[\"OdtExporterMetadata\"](this, this.docContents);\n      this.footnotes = new _footnotes__WEBPACK_IMPORTED_MODULE_7__[\"OdtExporterFootnotes\"](this, this.docContents);\n      this.render = new _render__WEBPACK_IMPORTED_MODULE_5__[\"OdtExporterRender\"](this, this.docContents);\n      this.styles = new _styles__WEBPACK_IMPORTED_MODULE_9__[\"OdtExporterStyles\"](this);\n      this.math = new _math__WEBPACK_IMPORTED_MODULE_10__[\"OdtExporterMath\"](this);\n      this.images = new _images__WEBPACK_IMPORTED_MODULE_4__[\"OdtExporterImages\"](this, this.imageDB, this.docContents);\n      this.citations = new _citations__WEBPACK_IMPORTED_MODULE_3__[\"OdtExporterCitations\"](this, this.bibDB, this.citationStyles, this.citationLocales, this.docContents);\n      this.richtext = new _richtext__WEBPACK_IMPORTED_MODULE_6__[\"OdtExporterRichtext\"](this, this.images);\n      this.xml = new _tools_xml_zip__WEBPACK_IMPORTED_MODULE_1__[\"XmlZip\"](Object(_tools_file__WEBPACK_IMPORTED_MODULE_0__[\"createSlug\"])(this.docTitle) + '.odt', this.templateUrl, 'application/vnd.oasis.opendocument.text');\n      this.xml.init().then(function () {\n        return _this.styles.init();\n      }).then(function () {\n        return _this.metadata.init();\n      }).then(function () {\n        return _this.citations.init();\n      }).then(function () {\n        return _this.math.init();\n      }).then(function () {\n        return _this.render.init();\n      }).then(function () {\n        return _this.images.init();\n      }).then(function () {\n        return _this.footnotes.init();\n      }).then(function () {\n        _this.render.getTagData(_this.citations.pmBib);\n\n        _this.render.render();\n\n        _this.xml.prepareAndDownload();\n      });\n    }\n  }]);\n\n  return OdtExporter;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/odt/index.js?");

/***/ }),

/***/ "./js/modules/exporter/odt/math.js":
/*!*****************************************!*\
  !*** ./js/modules/exporter/odt/math.js ***!
  \*****************************************/
/*! exports provided: OdtExporterMath */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"OdtExporterMath\", function() { return OdtExporterMath; });\n/* harmony import */ var texzilla__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! texzilla */ \"./node_modules/texzilla/TeXZilla.js\");\n/* harmony import */ var texzilla__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(texzilla__WEBPACK_IMPORTED_MODULE_0__);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\nvar OdtExporterMath =\n/*#__PURE__*/\nfunction () {\n  function OdtExporterMath(exporter) {\n    _classCallCheck(this, OdtExporterMath);\n\n    this.exporter = exporter;\n    this.objectCounter = 1;\n    this.manifestXml = false;\n  }\n\n  _createClass(OdtExporterMath, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.exporter.xml.getXml(\"META-INF/manifest.xml\").then(function (manifestXml) {\n        _this.manifestXml = manifestXml;\n\n        _this.checkObjectCounter();\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"checkObjectCounter\",\n    value: function checkObjectCounter() {\n      var _this2 = this;\n\n      var manifestEl = this.manifestXml.querySelector('manifest');\n      var fileEntries = manifestEl.querySelectorAll('file-entry');\n      fileEntries.forEach(function (fileEntry) {\n        var fullPath = fileEntry.getAttribute('manifest:full-path');\n        var dir = fullPath.split('/')[0];\n        var dirParts = dir.split(' ');\n\n        if (dirParts.length === 2 && dirParts[0] === 'Object') {\n          var objectNumber = parseInt(dirParts[1]);\n\n          if (objectNumber >= _this2.objectCounter) {\n            _this2.objectCounter = objectNumber + 1;\n          }\n        }\n      });\n    }\n  }, {\n    key: \"addMath\",\n    value: function addMath(latex) {\n      var mathml = texzilla__WEBPACK_IMPORTED_MODULE_0___default.a.toMathML(latex);\n      var objectNumber = this.objectCounter++;\n      this.exporter.xml.addXmlFile(\"Object \".concat(objectNumber, \"/content.xml\"), mathml);\n      var manifestEl = this.manifestXml.querySelector('manifest');\n      var stringOne = \"<manifest:file-entry manifest:full-path=\\\"Object \".concat(objectNumber, \"/content.xml\\\" manifest:media-type=\\\"text/xml\\\"/>\");\n      manifestEl.insertAdjacentHTML('beforeEnd', stringOne);\n      var stringTwo = \"<manifest:file-entry manifest:full-path=\\\"Object \".concat(objectNumber, \"/\\\" manifest:version=\\\"1.2\\\" manifest:media-type=\\\"application/vnd.oasis.opendocument.formula\\\"/>\");\n      manifestEl.insertAdjacentHTML('beforeEnd', stringTwo);\n      return objectNumber;\n    }\n  }]);\n\n  return OdtExporterMath;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/odt/math.js?");

/***/ }),

/***/ "./js/modules/exporter/odt/metadata.js":
/*!*********************************************!*\
  !*** ./js/modules/exporter/odt/metadata.js ***!
  \*********************************************/
/*! exports provided: OdtExporterMetadata */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"OdtExporterMetadata\", function() { return OdtExporterMetadata; });\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar OdtExporterMetadata =\n/*#__PURE__*/\nfunction () {\n  function OdtExporterMetadata(exporter, docContents) {\n    _classCallCheck(this, OdtExporterMetadata);\n\n    this.exporter = exporter;\n    this.docContents = docContents;\n    this.metaXml = false;\n    this.metadata = {\n      authors: this.docContents.content.reduce(function (authors, part) {\n        if (part.type === 'contributors_part' && part.attrs.metadata === 'authors' && part.content) {\n          return authors.concat(part.content.map(function (authorNode) {\n            return authorNode.attrs;\n          }));\n        } else {\n          return authors;\n        }\n      }, []),\n      keywords: this.docContents.content.reduce(function (keywords, part) {\n        if (part.type === 'tags_part' && part.attrs.metadata === 'keywords' && part.content) {\n          return keywords.concat(part.content.map(function (keywordNode) {\n            return keywordNode.attrs.tag;\n          }));\n        } else {\n          return keywords;\n        }\n      }, []),\n      title: Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__[\"textContent\"])(this.docContents.content[0]),\n      language: this.exporter.doc.settings.language\n    };\n  }\n\n  _createClass(OdtExporterMetadata, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.exporter.xml.getXml(\"meta.xml\").then(function (metaXml) {\n        _this.metaXml = metaXml;\n\n        _this.addMetadata();\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"addMetadata\",\n    value: function addMetadata() {\n      var metaEl = this.metaXml.querySelector('meta'); // Title\n\n      var titleEl = this.metaXml.querySelector('title');\n\n      if (!titleEl) {\n        metaEl.insertAdjacentHTML('beforeEnd', '<dc:title></dc:title>');\n        titleEl = this.metaXml.querySelector('title');\n      }\n\n      titleEl.innerHTML = Object(_common__WEBPACK_IMPORTED_MODULE_1__[\"escapeText\"])(this.metadata.title); // Authors\n\n      var authors = this.metadata.authors.map(function (author) {\n        var nameParts = [];\n\n        if (author.firstname) {\n          nameParts.push(author.firstname);\n        }\n\n        if (author.lastname) {\n          nameParts.push(author.lastname);\n        }\n\n        if (!nameParts.length && author.institution) {\n          // We have an institution but no names. Use institution as name.\n          nameParts.push(author.institution);\n        }\n\n        return nameParts.join(' ');\n      });\n      var initialAuthor = authors.length ? Object(_common__WEBPACK_IMPORTED_MODULE_1__[\"escapeText\"])(authors[0]) : gettext('Unknown'); // TODO: We likely want to differentiate between first and last author.\n\n      var lastAuthor = initialAuthor;\n      var lastAuthorEl = this.metaXml.querySelector('creator');\n\n      if (!lastAuthorEl) {\n        metaEl.insertAdjacentHTML('beforeEnd', '<dc:creator></dc:creator>');\n        lastAuthorEl = this.metaXml.querySelector('creator');\n      }\n\n      lastAuthorEl.innerHTML = lastAuthor;\n      var initialAuthorEl = this.metaXml.querySelector('initial-creator');\n\n      if (!initialAuthorEl) {\n        metaEl.insertAdjacentHTML('beforeEnd', '<meta:initial-creator></meta:initial-creator>');\n        initialAuthorEl = this.metaXml.querySelector('initial-creator');\n      }\n\n      initialAuthorEl.innerHTML = initialAuthor; // Keywords\n      // Remove all existing keywords\n\n      var keywordEls = this.metaXml.querySelectorAll('keywords');\n      keywordEls.forEach(function (keywordEl) {\n        return keywordEl.parentNode.removeChild(keywordEl);\n      }); // Add new keywords\n\n      var keywords = this.metadata.keywords;\n      keywords.forEach(function (keyword) {\n        return metaEl.insertAdjacentHTML('beforeEnd', \"<meta:keyword>\".concat(Object(_common__WEBPACK_IMPORTED_MODULE_1__[\"escapeText\"])(keyword), \"</meta:keyword>\"));\n      }); // language\n      // LibreOffice seems to ignore the value set in metadata and instead uses\n      // the one set in default styles. So we set both.\n\n      this.exporter.styles.setLanguage(this.metadata.language);\n      var languageEl = this.metaXml.querySelector('language');\n\n      if (!languageEl) {\n        metaEl.insertAdjacentHTML('beforeEnd', '<dc:language></dc:language>');\n        languageEl = this.metaXml.querySelector('language');\n      }\n\n      languageEl.innerHTML = this.metadata.language; // time\n\n      var date = new Date();\n      var dateString = date.toISOString().split('.')[0];\n      var createdEl = this.metaXml.querySelector('creation-date');\n      createdEl.innerHTML = dateString;\n      var dateEl = this.metaXml.querySelector('date');\n\n      if (!dateEl) {\n        metaEl.insertAdjacentHTML('beforeEnd', '<dc:date></dc:date>');\n        dateEl = this.metaXml.querySelector('date');\n      }\n\n      dateEl.innerHTML = \"\".concat(dateString, \".000000000\");\n    }\n  }]);\n\n  return OdtExporterMetadata;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/odt/metadata.js?");

/***/ }),

/***/ "./js/modules/exporter/odt/render.js":
/*!*******************************************!*\
  !*** ./js/modules/exporter/odt/render.js ***!
  \*******************************************/
/*! exports provided: OdtExporterRender */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"OdtExporterRender\", function() { return OdtExporterRender; });\n/* harmony import */ var _tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../tools/doc_contents */ \"./js/modules/exporter/tools/doc_contents.js\");\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\n/* harmony import */ var _schema_i18n__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../schema/i18n */ \"./js/modules/schema/i18n.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\n\nvar OdtExporterRender =\n/*#__PURE__*/\nfunction () {\n  function OdtExporterRender(exporter, docContents) {\n    _classCallCheck(this, OdtExporterRender);\n\n    this.exporter = exporter;\n    this.docContents = docContents;\n    this.filePath = \"content.xml\";\n    this.xml = false;\n  }\n\n  _createClass(OdtExporterRender, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.exporter.xml.getXml(this.filePath).then(function (xml) {\n        _this.xml = xml;\n        return Promise.resolve();\n      });\n    } // Define the tags that are to be looked for in the document\n\n  }, {\n    key: \"getTagData\",\n    value: function getTagData(pmBib) {\n      this.tags = this.docContents.content.map(function (node) {\n        var tag = {};\n\n        switch (node.type) {\n          case 'title':\n            tag.title = 'title';\n            tag.content = Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__[\"textContent\"])(node);\n            break;\n\n          case 'heading_part':\n            tag.title = node.attrs.id;\n            tag.content = Object(_tools_doc_contents__WEBPACK_IMPORTED_MODULE_0__[\"textContent\"])(node);\n            break;\n\n          case 'table_part':\n          case 'richtext_part':\n            tag.title = \"@\".concat(node.attrs.id);\n            tag.content = node.content;\n            break;\n\n          case 'contributors_part':\n            tag.title = node.attrs.id; // TODO: This is a very basic reduction of the author info into\n            // a simple string. We should expand the templating system so\n            // that one can specify more about the output.\n\n            tag.content = node.content ? node.content.map(function (node) {\n              var contributor = node.attrs,\n                  nameParts = [];\n              var affiliation = false;\n\n              if (contributor.firstname) {\n                nameParts.push(contributor.firstname);\n              }\n\n              if (contributor.lastname) {\n                nameParts.push(contributor.lastname);\n              }\n\n              if (contributor.institution) {\n                if (nameParts.length) {\n                  affiliation = contributor.institution;\n                } else {\n                  // We have an institution but no names. Use institution as name.\n                  nameParts.push(contributor.institution);\n                }\n              }\n\n              var parts = [nameParts.join(' ')];\n\n              if (affiliation) {\n                parts.push(affiliation);\n              }\n\n              if (contributor.email) {\n                parts.push(contributor.email);\n              }\n\n              return parts.join(', ');\n            }).join('; ') : '';\n            break;\n\n          case 'tags_part':\n            tag.title = node.attrs.id;\n            tag.content = node.content ? node.content.map(function (node) {\n              return node.attrs.tag;\n            }).join(', ') : '';\n            break;\n        }\n\n        return tag;\n      });\n      var settings = this.exporter.doc.settings,\n          bibliographyHeader = settings.bibliography_header[settings.language] || _schema_i18n__WEBPACK_IMPORTED_MODULE_2__[\"BIBLIOGRAPHY_HEADERS\"][settings.language];\n      this.tags.push({\n        title: '@bibliography',\n        // The '@' triggers handling as block\n        content: pmBib ? [{\n          type: 'bibliography_heading',\n          content: [{\n            type: 'text',\n            text: bibliographyHeader\n          }]\n        }].concat(pmBib.content) : [{\n          type: 'paragraph',\n          content: [{\n            type: 'text',\n            text: ' '\n          }]\n        }]\n      });\n    } // go through content.xml looking for tags and replace them with the given\n    // replacements.\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var pars = this.xml.querySelectorAll('p');\n      pars.forEach(function (par) {\n        var text = par.textContent;\n\n        _this2.tags.forEach(function (tag) {\n          var tagString = tag.title;\n\n          if (text.includes(\"{\".concat(tagString, \"}\"))) {\n            tag.par = par;\n\n            if (tag.title[0] === '@') {\n              _this2.parRender(tag);\n            } else {\n              _this2.inlineRender(tag);\n            }\n          }\n        });\n      });\n    } // Render Tags that only exchange inline content\n\n  }, {\n    key: \"inlineRender\",\n    value: function inlineRender(tag) {\n      var texts = tag.par.textContent.split(\"{\".concat(tag.title, \"}\"));\n      var fullText = texts[0] + (tag.content ? tag.content : '') + texts[1];\n      tag.par.innerHTML = Object(_common__WEBPACK_IMPORTED_MODULE_1__[\"escapeText\"])(fullText);\n    } // Render tags that exchange paragraphs\n\n  }, {\n    key: \"parRender\",\n    value: function parRender(tag) {\n      var _this3 = this;\n\n      var section = tag.par.hasAttribute('text:style-name') ? tag.par.getAttribute('text:style-name') : 'Text_20_body';\n      var outXml = tag.content ? tag.content.map(function (content) {\n        return _this3.exporter.richtext.transformRichtext(content, {\n          citationType: _this3.exporter.citations.citFm.citationType,\n          section: section\n        });\n      }).join('') : '';\n      tag.par.insertAdjacentHTML('beforebegin', outXml);\n      tag.par.parentNode.removeChild(tag.par);\n    }\n  }]);\n\n  return OdtExporterRender;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/odt/render.js?");

/***/ }),

/***/ "./js/modules/exporter/odt/richtext.js":
/*!*********************************************!*\
  !*** ./js/modules/exporter/odt/richtext.js ***!
  \*********************************************/
/*! exports provided: OdtExporterRichtext */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"OdtExporterRichtext\", function() { return OdtExporterRichtext; });\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\n/* harmony import */ var _schema_i18n__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../schema/i18n */ \"./js/modules/schema/i18n.js\");\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"\\n                    <draw:frame draw:style-name=\\\"\", \"\\\" draw:name=\\\"Object\", \"\\\" text:anchor-type=\\\"as-char\\\" draw:z-index=\\\"\", \"\\\">\\n                        <draw:object xlink:href=\\\"./Object \", \"\\\" xlink:type=\\\"simple\\\" xlink:show=\\\"embed\\\" xlink:actuate=\\\"onLoad\\\"/>\\n                        <svg:desc>formula</svg:desc>\\n                    </draw:frame>\"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"\\n                        <draw:frame draw:style-name=\\\"\", \"\\\" draw:name=\\\"Object\", \"\\\" text:anchor-type=\\\"as-char\\\" draw:z-index=\\\"\", \"\\\">\\n                            <draw:object xlink:href=\\\"./Object \", \"\\\" xlink:type=\\\"simple\\\" xlink:show=\\\"embed\\\" xlink:actuate=\\\"onLoad\\\"/>\\n                            <svg:desc>formula</svg:desc>\\n                        </draw:frame>\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n                        <draw:frame draw:style-name=\\\"\", \"\\\" draw:name=\\\"Image\", \"\\\" text:anchor-type=\\\"\", \"\\\" style:rel-width=\\\"\", \"%\\\" style:rel-height=\\\"scale\\\" svg:width=\\\"\", \"pt\\\" svg:height=\\\"\", \"pt\\\" draw:z-index=\\\"\", \"\\\">\\n                            <draw:image xlink:href=\\\"Pictures/\", \"\\\" xlink:type=\\\"simple\\\" xlink:show=\\\"embed\\\" xlink:actuate=\\\"onLoad\\\"/>\\n                        </draw:frame>\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n                            </text:p>\\n                        </draw:text-box>\\n                    </draw:frame>\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"<draw:frame draw:style-name=\\\"fr\", \"\\\" draw:name=\\\"Frame\", \"\\\" text:anchor-type=\\\"paragraph\\\" svg:width=\\\"0.0161in\\\" style:rel-width=\\\"\", \"%\\\" draw:z-index=\\\"\", \"\\\">\\n                        <draw:text-box fo:min-height=\\\"0in\\\">\\n                            <text:p text:style-name=\\\"Figure\\\">\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n                        </text:note-body>\\n                    </text:note>\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n                    <text:note text:id=\\\"ftn\", \"\\\" text:note-class=\\\"footnote\\\">\\n                        <text:note-citation>\", \"</text:note-citation>\\n                        <text:note-body>\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n                    </text:note-body>\\n                </text:note>\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n                <text:note text:id=\\\"ftn\", \"\\\" text:note-class=\\\"footnote\\\">\\n                    <text:note-citation>\", \"</text:note-citation>\\n                    <text:note-body>\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n\nvar OdtExporterRichtext =\n/*#__PURE__*/\nfunction () {\n  function OdtExporterRichtext(exporter, images) {\n    _classCallCheck(this, OdtExporterRichtext);\n\n    this.exporter = exporter;\n    this.images = images;\n    this.imgCounter = 1;\n    this.fnCounter = 0; // real footnotes\n\n    this.fnAlikeCounter = 0; // real footnotes and citations as footnotes\n\n    this.figureCounter = {}; // counters for each type of figure (figure/table/photo)\n\n    this.zIndex = 0;\n  }\n\n  _createClass(OdtExporterRichtext, [{\n    key: \"transformRichtext\",\n    value: function transformRichtext(node) {\n      var _this = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var start = '',\n          content = '',\n          end = '';\n\n      switch (node.type) {\n        case 'paragraph':\n          if (!options.section) {\n            options.section = 'Text_20_body';\n          }\n\n          this.exporter.styles.checkParStyle(options.section);\n          start += \"<text:p text:style-name=\\\"\".concat(options.section, \"\\\">\");\n          end = '</text:p>' + end;\n          break;\n\n        case 'bibliography_heading':\n          this.exporter.styles.checkParStyle('Bibliography_20_Heading');\n          start += \"<text:p text:style-name=\\\"Bibliography_20_Heading\\\">\";\n          end = '</text:p>' + end;\n          break;\n\n        case 'heading1':\n          start += \"\\n                    <text:h text:outline-level=\\\"1\\\">\\n                    <text:bookmark text:name=\\\"\".concat(node.attrs.id, \"\\\"/>\");\n          end = '</text:h>' + end;\n          break;\n\n        case 'heading2':\n          start += \"\\n                    <text:h text:outline-level=\\\"2\\\">\\n                    <text:bookmark text:name=\\\"\".concat(node.attrs.id, \"\\\"/>\");\n          end = '</text:h>' + end;\n          break;\n\n        case 'heading3':\n          start += \"\\n                    <text:h text:outline-level=\\\"3\\\">\\n                    <text:bookmark text:name=\\\"\".concat(node.attrs.id, \"\\\"/>\");\n          end = '</text:h>' + end;\n          break;\n\n        case 'heading4':\n          start += \"\\n                    <text:h text:outline-level=\\\"4\\\">\\n                    <text:bookmark text:name=\\\"\".concat(node.attrs.id, \"\\\"/>\");\n          end = '</text:h>' + end;\n          break;\n\n        case 'heading5':\n          start += \"\\n                    <text:h text:outline-level=\\\"5\\\">\\n                    <text:bookmark text:name=\\\"\".concat(node.attrs.id, \"\\\"/>\");\n          end = '</text:h>' + end;\n          break;\n\n        case 'heading6':\n          start += \"\\n                    <text:h text:outline-level=\\\"6\\\">\\n                    <text:bookmark text:name=\\\"\".concat(node.attrs.id, \"\\\"/>\");\n          end = '</text:h>' + end;\n          break;\n\n        case 'code':\n          this.exporter.styles.checkParStyle('Preformatted_20_Text');\n          start += '<text:p text:style-name=\"Preformatted_20_Text\">';\n          end = '</text:p>' + end;\n          break;\n\n        case 'blockquote':\n          // This is imperfect, but Word doesn't seem to provide section/quotation nesting\n          options = Object.assign({}, options);\n          options.section = 'Quote';\n          break;\n\n        case 'ordered_list':\n          {\n            var olId = options.inOrderedList ? options.inOrderedList : this.exporter.styles.getOrderedListStyleId();\n            start += \"<text:list text:style-name=\\\"L\".concat(olId[0], \"\\\">\");\n            end = '</text:list>' + end;\n            options = Object.assign({}, options);\n            options.section = \"P\".concat(olId[1]);\n            options.inOrderedList = olId;\n            break;\n          }\n\n        case 'bullet_list':\n          {\n            var ulId = this.exporter.styles.getBulletListStyleId();\n            start += \"<text:list text:style-name=\\\"L\".concat(ulId[0], \"\\\">\");\n            end = '</text:list>' + end;\n            options = Object.assign({}, options);\n            options.section = \"P\".concat(ulId[1]);\n            break;\n          }\n\n        case 'list_item':\n          start += '<text:list-item>';\n          end = '</text:list-item>' + end;\n          break;\n\n        case 'footnotecontainer':\n          break;\n\n        case 'footnote':\n          options = Object.assign({}, options);\n          options.section = 'Footnote';\n          options.inFootnote = true;\n          content += this.transformRichtext({\n            type: 'footnotecontainer',\n            content: node.attrs.footnote\n          }, options);\n          start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject(), this.fnAlikeCounter++, this.fnAlikeCounter);\n          end = Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject2()) + end;\n          break;\n\n        case 'text':\n          {\n            var hyperlink, strong, em, underline, sup, sub, smallcaps; // Check for hyperlink, bold/strong and italic/em\n\n            if (node.marks) {\n              hyperlink = node.marks.find(function (mark) {\n                return mark.type === 'link';\n              });\n              strong = node.marks.find(function (mark) {\n                return mark.type === 'strong';\n              });\n              em = node.marks.find(function (mark) {\n                return mark.type === 'em';\n              });\n              underline = node.marks.find(function (mark) {\n                return mark.type === 'underline';\n              });\n              smallcaps = node.marks.find(function (mark) {\n                return mark.type === 'smallcaps';\n              });\n              sup = node.marks.find(function (mark) {\n                return mark.type === 'sup';\n              });\n              sub = node.marks.find(function (mark) {\n                return mark.type === 'sub';\n              });\n            }\n\n            if (hyperlink) {\n              start += \"<text:a xlink:type=\\\"simple\\\" xlink:href=\\\"\".concat(Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"escapeText\"])(hyperlink.attrs.href), \"\\\">\");\n              end = '</text:a>' + end;\n            }\n\n            var attributes = '';\n\n            if (em) {\n              attributes += 'e';\n            }\n\n            if (strong) {\n              attributes += 's';\n            }\n\n            if (underline) {\n              attributes += 'u';\n            }\n\n            if (smallcaps) {\n              attributes += 'c';\n            }\n\n            if (sup) {\n              attributes += 'p';\n            } else if (sub) {\n              attributes += 'b';\n            }\n\n            if (attributes.length) {\n              var styleId = this.exporter.styles.getInlineStyleId(attributes);\n              start += \"<text:span text:style-name=\\\"T\".concat(styleId, \"\\\">\");\n              end = '</text:span>' + end;\n            }\n\n            content += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"escapeText\"])(node.text);\n            break;\n          }\n\n        case 'citation':\n          {\n            var cit; // We take the first citation from the stack and remove it.\n\n            if (options.inFootnote) {\n              cit = this.exporter.footnotes.citations.pmCits.shift();\n            } else {\n              cit = this.exporter.citations.pmCits.shift();\n            }\n\n            if (options.citationType && options.citationType === 'note') {\n              // If the citations are in notes (footnotes), we need to\n              // put the contents of this citation in a footnote.\n              start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject3(), this.fnAlikeCounter++, this.fnAlikeCounter);\n              end = Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject4()) + end;\n              options = Object.assign({}, options);\n              options.section = 'Footnote';\n              content += this.transformRichtext({\n                type: 'paragraph',\n                content: cit.content\n              }, options);\n            } else {\n              cit.content.forEach(function (citContent) {\n                content += _this.transformRichtext(citContent, options);\n              });\n            }\n\n            break;\n          }\n\n        case 'figure':\n          {\n            // NOTE: The difficulty is to make several images with different\n            // alignments/widths not overlap one-another. The below code\n            // makes a reasonable attempt at that, but it seems there is no\n            // way to guarantee it from happening.\n            this.exporter.styles.checkParStyle('Standard');\n            start += '<text:p text:style-name=\"Standard\">';\n            end = '</text:p>' + end;\n\n            if (node.attrs.aligned === 'center') {\n              // Needed to prevent subsequent image from overlapping\n              end = end + '<text:p text:style-name=\"Standard\"></text:p>';\n            }\n\n            var caption = Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"escapeText\"])(node.attrs.caption); // The figure category should not be in the\n            // user's language but rather the document language\n\n            var figCat = node.attrs.figureCategory;\n\n            if (figCat !== 'none') {\n              if (!this.figureCounter[figCat]) {\n                this.figureCounter[figCat] = 1;\n              }\n\n              var figCount = this.figureCounter[figCat]++;\n              var figCountXml = \"<text:sequence text:ref-name=\\\"ref\".concat(figCat).concat(figCount - 1, \"\\\" text:name=\\\"\").concat(figCat, \"\\\" text:formula=\\\"ooow:\").concat(figCat, \"+1\\\" style:num-format=\\\"1\\\">\").concat(figCount, \"</text:sequence>\");\n\n              if (caption.length) {\n                caption = \"\".concat(_schema_i18n__WEBPACK_IMPORTED_MODULE_1__[\"FIG_CATS\"][figCat][this.exporter.settings.language], \" \").concat(figCountXml, \": \").concat(caption);\n              } else {\n                caption = \"\".concat(_schema_i18n__WEBPACK_IMPORTED_MODULE_1__[\"FIG_CATS\"][figCat][this.exporter.settings.language], \" \").concat(figCountXml);\n              }\n            }\n\n            var relWidth = node.attrs.width;\n            var aligned = node.attrs.aligned;\n            var frame;\n\n            if (caption.length || node.attrs.image === false) {\n              frame = true;\n              this.exporter.styles.checkParStyle('Caption');\n              this.exporter.styles.checkParStyle('Figure');\n              var graphicStyleId = this.exporter.styles.getGraphicStyleId('Frame', aligned);\n              start += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject5(), graphicStyleId, graphicStyleId, relWidth, this.zIndex++);\n              relWidth = '100'; // percentage width of image inside of frame is always 100\n\n              aligned = 'center'; // Aligned inside of frame is always 'center'\n\n              end = Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject6()) + end;\n\n              if (caption.length) {\n                end = \"<text:line-break />\".concat(caption) + end;\n              }\n            }\n\n            if (node.attrs.image !== false) {\n              var imgDBEntry = this.images.imageDB.db[node.attrs.image];\n              var imgFileName = this.images.imgIdTranslation[node.attrs.image];\n              var height = imgDBEntry.height * 3 / 4; // more or less px to point\n\n              var width = imgDBEntry.width * 3 / 4; // more or less px to point\n\n              var _graphicStyleId = this.exporter.styles.getGraphicStyleId('Graphics', aligned);\n\n              content += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject7(), _graphicStyleId, this.imgCounter++, frame ? 'paragraph' : 'as-char', relWidth, width, height, this.zIndex++, imgFileName);\n            } else {\n              var latex = node.attrs.equation;\n              var objectNumber = this.exporter.math.addMath(latex);\n\n              var _graphicStyleId2 = this.exporter.styles.getGraphicStyleId('Formula');\n\n              content += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject8(), _graphicStyleId2, objectNumber, this.zIndex++, objectNumber);\n            }\n\n            content += \"<text:bookmark text:name=\\\"\".concat(node.attrs.id, \"\\\"/>\");\n            break;\n          }\n\n        case 'table':\n          {\n            var columns = node.content[0].content.length;\n\n            if (node.attrs.width === '100') {\n              start += '<table:table>';\n            } else {\n              var _styleId = this.exporter.styles.getTableStyleId(node.attrs.aligned, node.attrs.width);\n\n              start += \"<table:table table:style-name=\\\"Table\".concat(_styleId, \"\\\">\");\n            }\n\n            start += \"<table:table-column table:number-columns-repeated=\\\"\".concat(columns, \"\\\" />\");\n            end = '</table:table>' + end;\n            break;\n          }\n\n        case 'table_row':\n          start += '<table:table-row>';\n          end = '</table:table-row>' + end;\n          break;\n\n        case 'table_cell':\n        case 'table_header':\n          if (node.attrs.rowspan && node.attrs.colspan) {\n            start += \"<table:table-cell\".concat(node.attrs.rowspan > 1 ? \" table:number-rows-spanned=\\\"\".concat(node.attrs.rowspan, \"\\\"\") : '').concat(node.attrs.colspan > 1 ? \" table:number-columns-spanned=\\\"\".concat(node.attrs.colspan, \"\\\"\") : '', \">\");\n            end = '</table:table-cell>' + end;\n          } else {\n            start += '<table:covered-table-cell/>';\n          }\n\n          break;\n\n        case 'equation':\n          {\n            var _latex = node.attrs.equation;\n\n            var _objectNumber = this.exporter.math.addMath(_latex);\n\n            var _styleId2 = this.exporter.styles.getGraphicStyleId('Formula');\n\n            content += Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject9(), _styleId2, _objectNumber, this.zIndex++, _objectNumber);\n            break;\n          }\n\n        case 'hard_break':\n          content += '<text:line-break/>';\n          break;\n        // CSL bib entries\n\n        case 'cslbib':\n          options = Object.assign({}, options);\n          options.section = 'Bibliography_20_1';\n          break;\n\n        case 'cslblock':\n          end = '<text:line-break/>' + end;\n          break;\n\n        case 'cslleftmargin':\n          end = '<text:tab/>' + end;\n          break;\n\n        case 'cslindent':\n          start += '<text:tab/>';\n          end = '<text:line-break/>' + end;\n          break;\n\n        case 'cslentry':\n          this.exporter.styles.checkParStyle(options.section);\n          start += \"<text:p text:style-name=\\\"\".concat(options.section, \"\\\">\");\n          end = '</text:p>' + end;\n          break;\n\n        case 'cslinline':\n        case 'cslrightinline':\n          break;\n\n        default:\n          break;\n      }\n\n      if (node.content) {\n        for (var i = 0; i < node.content.length; i++) {\n          content += this.transformRichtext(node.content[i], options);\n        }\n      }\n\n      return start + content + end;\n    }\n  }]);\n\n  return OdtExporterRichtext;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/odt/richtext.js?");

/***/ }),

/***/ "./js/modules/exporter/odt/styles.js":
/*!*******************************************!*\
  !*** ./js/modules/exporter/odt/styles.js ***!
  \*******************************************/
/*! exports provided: OdtExporterStyles */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"OdtExporterStyles\", function() { return OdtExporterStyles; });\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../common */ \"./js/modules/common/index.js\");\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _templateObject13() {\n  var data = _taggedTemplateLiteral([\"\\n                <text:list-level-style-number text:level=\\\"\", \"\\\" text:style-name=\\\"Numbering_20_Symbols\\\" style:num-suffix=\\\".\\\" style:num-format=\\\"1\\\">\\n                    <style:list-level-properties text:list-level-position-and-space-mode=\\\"label-alignment\\\">\\n                        <style:list-level-label-alignment text:label-followed-by=\\\"listtab\\\" text:list-tab-stop-position=\\\"\", \"in\\\" fo:text-indent=\\\"-0.25in\\\" fo:margin-left=\\\"\", \"in\\\" />\\n                    </style:list-level-properties>\\n                </text:list-level-style-number>\\n            \"]);\n\n  _templateObject13 = function _templateObject13() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject12() {\n  var data = _taggedTemplateLiteral([\"\\n            <text:list-style style:name=\\\"L\", \"\\\">\\n            </text:list-style>\\n        \"]);\n\n  _templateObject12 = function _templateObject12() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject11() {\n  var data = _taggedTemplateLiteral([\"\\n                <text:list-level-style-bullet text:level=\\\"\", \"\\\" text:style-name=\\\"Bullet_20_Symbols\\\" text:bullet-char=\\\"\\u2022\\\">\\n                    <style:list-level-properties text:list-level-position-and-space-mode=\\\"label-alignment\\\">\\n                        <style:list-level-label-alignment text:label-followed-by=\\\"listtab\\\" text:list-tab-stop-position=\\\"\", \"in\\\" fo:text-indent=\\\"-0.25in\\\" fo:margin-left=\\\"\", \"in\\\" />\\n                    </style:list-level-properties>\\n                </text:list-level-style-bullet>\\n            \"]);\n\n  _templateObject11 = function _templateObject11() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject10() {\n  var data = _taggedTemplateLiteral([\"\\n            <text:list-style style:name=\\\"L\", \"\\\">\\n            </text:list-style>\\n        \"]);\n\n  _templateObject10 = function _templateObject10() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"\\n            <style:style style:name=\\\"Bibliography_20_1\\\" style:display-name=\\\"Bibliography 1\\\" style:family=\\\"paragraph\\\" style:parent-style-name=\\\"Index\\\" style:class=\\\"index\\\">\\n                <style:paragraph-properties fo:margin-left=\\\"\", \"\\\" fo:margin-right=\\\"0in\\\" fo:margin-top=\\\"0in\\\" fo:margin-bottom=\\\"\", \"\\\" loext:contextual-spacing=\\\"false\\\" fo:text-indent=\\\"\", \"\\\" style:line-height-at-least=\\\"\", \"\\\" style:auto-text-indent=\\\"false\\\">\\n                    \", \"\\n                </style:paragraph-properties>\\n            </style:style>\"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"\\n            <style:style style:name=\\\"fr\", \"\\\" style:family=\\\"graphic\\\" style:parent-style-name=\\\"\", \"\\\">\\n                \", \" style:number-wrapped-paragraphs=\\\"no-limit\\\"\\n            </style:style>\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n            <style:style style:name=\\\"Table\", \"\\\" style:family=\\\"table\\\">\\n                <style:table-properties style:rel-width=\\\"\", \"%\\\" table:align=\\\"\", \"\\\"/>\\n            </style:style>\\n        \"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n            <style:style style:name=\\\"T\", \"\\\" style:family=\\\"text\\\">\\n                <style:text-properties\", \"/>\\n            </style:style>\\n        \"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"<style:style style:name=\\\"Caption\\\" style:family=\\\"paragraph\\\" style:parent-style-name=\\\"Standard\\\" style:class=\\\"extra\\\">\\n            <style:paragraph-properties fo:margin-top=\\\"0.0835in\\\" fo:margin-bottom=\\\"0.0835in\\\" loext:contextual-spacing=\\\"false\\\" text:number-lines=\\\"false\\\" text:line-number=\\\"0\\\" />\\n            <style:text-properties fo:font-style=\\\"italic\\\" style:font-style-asian=\\\"italic\\\" style:font-style-complex=\\\"italic\\\" />\\n        </style:style>\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"<style:style style:name=\\\"Bibliography_20_Heading\\\" style:display-name=\\\"Bibliography Heading\\\" style:family=\\\"paragraph\\\" style:parent-style-name=\\\"Heading\\\" style:class=\\\"index\\\">\\n        <style:paragraph-properties fo:margin-left=\\\"0in\\\" fo:margin-right=\\\"0in\\\" fo:text-indent=\\\"0in\\\" style:auto-text-indent=\\\"false\\\" text:number-lines=\\\"false\\\" text:line-number=\\\"0\\\"/>\\n        <style:text-properties fo:font-size=\\\"16pt\\\" fo:font-weight=\\\"bold\\\" style:font-size-asian=\\\"16pt\\\" style:font-weight-asian=\\\"bold\\\" style:font-size-complex=\\\"16pt\\\" style:font-weight-complex=\\\"bold\\\"/>\\n    </style:style>\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n        <style:style style:name=\\\"Frame\\\" style:family=\\\"graphic\\\">\\n            <style:graphic-properties text:anchor-type=\\\"paragraph\\\" svg:x=\\\"0in\\\" svg:y=\\\"0in\\\" style:wrap=\\\"dynamic\\\" style:number-wrapped-paragraphs=\\\"no-limit\\\" style:wrap-contour=\\\"false\\\" style:vertical-pos=\\\"top\\\" style:vertical-rel=\\\"paragraph\\\" style:horizontal-pos=\\\"center\\\" style:horizontal-rel=\\\"paragraph\\\"/>\\n        </style:style>\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n        <style:style style:name=\\\"Graphics\\\" style:family=\\\"graphic\\\">\\n            <style:graphic-properties text:anchor-type=\\\"paragraph\\\" svg:x=\\\"0in\\\" svg:y=\\\"0in\\\" style:wrap=\\\"dynamic\\\" style:number-wrapped-paragraphs=\\\"no-limit\\\" style:wrap-contour=\\\"false\\\" style:vertical-pos=\\\"top\\\" style:vertical-rel=\\\"paragraph\\\" style:horizontal-pos=\\\"center\\\" style:horizontal-rel=\\\"paragraph\\\"/>\\n        </style:style>\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n        <style:style style:name=\\\"Formula\\\" style:family=\\\"graphic\\\">\\n            <style:graphic-properties text:anchor-type=\\\"as-char\\\" svg:y=\\\"0in\\\" fo:margin-left=\\\"0.0791in\\\" fo:margin-right=\\\"0.0791in\\\" style:vertical-pos=\\\"middle\\\" style:vertical-rel=\\\"text\\\"/>\\n        </style:style>\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\n\nvar GRAPHIC_STYLES = {\n  Formula: Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject()),\n  Graphics: Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject2()),\n  Frame: Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject3())\n};\nvar PAR_STYLES = {\n  Bibliography_20_Heading: Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject4()),\n  Caption: Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject5()),\n  Figure: '<style:style style:name=\"Figure\" style:family=\"paragraph\" style:parent-style-name=\"Caption\" style:class=\"extra\" />',\n  Standard: '<style:style style:name=\"Standard\" style:family=\"paragraph\" style:class=\"text\" />'\n};\nvar OdtExporterStyles =\n/*#__PURE__*/\nfunction () {\n  function OdtExporterStyles(exporter) {\n    _classCallCheck(this, OdtExporterStyles);\n\n    this.exporter = exporter;\n    this.contentXml = false;\n    this.stylesXml = false;\n    this.boldStyleId = false;\n    this.italicStyleId = false;\n    this.boldItalicStyleId = false;\n    this.inlineStyleIds = {};\n    this.tableStyleIds = {};\n    this.graphicStyleIds = {};\n    this.bulletListStyleId = [false, false];\n    this.inlineStyleCounter = 0;\n    this.tableStyleCounter = 0;\n    this.blockStyleCounter = 0;\n    this.listStyleCounter = 0;\n    this.graphicStyleCounter = 0;\n  }\n\n  _createClass(OdtExporterStyles, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      return this.exporter.xml.getXml(\"styles.xml\").then(function (stylesXml) {\n        _this.stylesXml = stylesXml;\n        return _this.exporter.xml.getXml(\"content.xml\");\n      }).then(function (contentXml) {\n        _this.contentXml = contentXml;\n\n        _this.getStyleCounters();\n\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"getStyleCounters\",\n    value: function getStyleCounters() {\n      var _this2 = this;\n\n      var styles = this.contentXml.querySelectorAll('automatic-styles style');\n      styles.forEach(function (style) {\n        var styleNumber = parseInt(style.getAttribute('style:name').replace(/\\D/g, ''));\n        var styleFamily = style.getAttribute('style:family');\n\n        if (styleFamily === 'text') {\n          if (styleNumber > _this2.inlineStyleCounter) {\n            _this2.inlineStyleCounter = styleNumber;\n          }\n        } else if (styleFamily === 'table') {\n          if (styleNumber > _this2.tableStyleCounter) {\n            _this2.tableStyleCounter = styleNumber;\n          }\n        } else if (styleFamily === 'paragraph') {\n          if (styleNumber > _this2.blockStyleCounter) {\n            _this2.blockStyleCounter = styleNumber;\n          }\n        } else if (styleFamily === 'graphic') {\n          if (styleNumber > _this2.graphicStyleCounter) {\n            _this2.graphicStyleCounter = styleNumber;\n          }\n        }\n      });\n      var listStyles = this.contentXml.querySelectorAll('automatic-styles list-style');\n      listStyles.forEach(function (style) {\n        var styleNumber = parseInt(style.getAttribute('style:name').replace(/\\D/g, ''));\n\n        if (styleNumber > _this2.listStyleCounter) {\n          _this2.listStyleCounter = styleNumber;\n        }\n      });\n    }\n    /*\n    attributes is a string that consists of these characters (in this order).\n    Only one of super/sub possible.\n    e = italic/em\n    s = bold/strong\n    u = underline\n    c = small caps\n    p = super\n    b = sub\n    */\n\n  }, {\n    key: \"getInlineStyleId\",\n    value: function getInlineStyleId(attributes) {\n      if (this.inlineStyleIds[attributes]) {\n        return this.inlineStyleIds[attributes];\n      }\n\n      var styleProperties = '';\n\n      if (attributes.includes('e')) {\n        styleProperties += ' fo:font-style=\"italic\" style:font-style-asian=\"italic\" style:font-style-complex=\"italic\"';\n      }\n\n      if (attributes.includes('s')) {\n        styleProperties += ' fo:font-weight=\"bold\" style:font-weight-asian=\"bold\" style:font-weight-complex=\"bold\"';\n      }\n\n      if (attributes.includes('u')) {\n        styleProperties += ' style:text-underline-style=\"solid\" style:text-underline-width=\"auto\" style:text-underline-color=\"font-color\"';\n      }\n\n      if (attributes.includes('c')) {\n        styleProperties += ' fo:font-variant=\"small-caps\"';\n      }\n\n      if (attributes.includes('p')) {\n        styleProperties += ' style:text-position=\"super 58%\"';\n      } else if (attributes.includes('b')) {\n        styleProperties += ' style:text-position=\"sub 58%\"';\n      }\n\n      var styleCounter = ++this.inlineStyleCounter;\n      this.inlineStyleIds[attributes] = styleCounter;\n      var autoStylesEl = this.contentXml.querySelector('automatic-styles');\n      autoStylesEl.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject6(), styleCounter, styleProperties));\n      return styleCounter;\n    }\n    /*\n    aligned: left/center/right\n    width: '75'/'50'/'25' = percentage width - 100% doesn't need any style\n    */\n\n  }, {\n    key: \"getTableStyleId\",\n    value: function getTableStyleId(aligned, width) {\n      if (this.tableStyleIds[aligned + width]) {\n        return this.tableStyleIds[aligned + width];\n      }\n\n      var styleCounter = ++this.tableStyleCounter;\n      this.tableStyleIds[aligned + width] = styleCounter;\n      var autoStylesEl = this.contentXml.querySelector('automatic-styles');\n      autoStylesEl.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject7(), styleCounter, width, aligned));\n      return styleCounter;\n    }\n  }, {\n    key: \"checkParStyle\",\n    value: function checkParStyle(styleName) {\n      var stylesParStyle = this.stylesXml.querySelector(\"style[*|name=\\\"\".concat(styleName, \"\\\"]\"));\n      var contentParStyle = this.contentXml.querySelector(\"style[*|name=\\\"\".concat(styleName, \"\\\"]\"));\n\n      if (!stylesParStyle && !contentParStyle) {\n        var stylesEl = this.stylesXml.querySelector('styles');\n        var displayName = styleName.split('_20_').join(' ');\n        stylesEl.insertAdjacentHTML('beforeEnd', PAR_STYLES[styleName] || \"<style:style style:name=\\\"\".concat(styleName, \"\\\" style:display-name=\\\"\").concat(displayName, \"\\\" style:family=\\\"paragraph\\\" style:parent-style-name=\\\"Standard\\\" style:class=\\\"text\\\" />\"));\n      }\n    }\n  }, {\n    key: \"checkGraphicStyle\",\n    value: function checkGraphicStyle(styleName) {\n      var stylesParStyle = this.stylesXml.querySelector(\"style[*|name=\\\"\".concat(styleName, \"\\\"]\"));\n      var contentParStyle = this.contentXml.querySelector(\"style[*|name=\\\"\".concat(styleName, \"\\\"]\"));\n\n      if (!stylesParStyle && !contentParStyle) {\n        var stylesEl = this.stylesXml.querySelector('styles');\n        stylesEl.insertAdjacentHTML('beforeEnd', GRAPHIC_STYLES[styleName]);\n      }\n    }\n    /*\n    styleName: Frame/Formula/Graphics\n    aligned: left/center/right (not used for Formula)\n    */\n\n  }, {\n    key: \"getGraphicStyleId\",\n    value: function getGraphicStyleId(styleName) {\n      var aligned = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n      if (this.graphicStyleIds[styleName + aligned]) {\n        return this.graphicStyleIds[styleName + aligned];\n      }\n\n      this.checkGraphicStyle(styleName);\n      var styleCounter = ++this.graphicStyleCounter;\n      this.graphicStyleIds[styleName + aligned] = styleCounter;\n      var autoStylesEl = this.contentXml.querySelector('automatic-styles');\n      autoStylesEl.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject8(), styleCounter, styleName, styleName === 'Formula' ? \"<style:graphic-properties style:vertical-pos=\\\"from-top\\\" style:horizontal-pos=\\\"from-left\\\" style:horizontal-rel=\\\"paragraph-content\\\" draw:ole-draw-aspect=\\\"1\\\" />\" : \"<style:graphic-properties fo:margin-left=\\\"0in\\\" fo:margin-right=\\\"0in\\\" fo:margin-top=\\\"0in\\\" fo:margin-bottom=\\\"0in\\\" \".concat(aligned === 'center' ? 'style:wrap=\"none\"' : 'style:wrap=\"dynamic\"  style:number-wrapped-paragraphs=\"no-limit\"', \" style:vertical-pos=\\\"top\\\" style:vertical-rel=\\\"paragraph\\\" style:horizontal-pos=\\\"\").concat(aligned, \"\\\" style:horizontal-rel=\\\"paragraph\\\" fo:padding=\\\"0in\\\" fo:border=\\\"none\\\" loext:rel-width-rel=\\\"paragraph\\\" />\")));\n      return styleCounter;\n    }\n  }, {\n    key: \"addReferenceStyle\",\n    value: function addReferenceStyle(bibInfo) {\n      // The style called \"Bibliography_20_1\" will override any previous style\n      // of the same name.\n      var stylesParStyle = this.stylesXml.querySelector(\"style[*|name=\\\"Bibliography_20_1\\\"]\");\n\n      if (stylesParStyle) {\n        stylesParStyle.parentNode.removeChild(stylesParStyle);\n      }\n\n      var contentParStyle = this.contentXml.querySelector(\"style[*|name=\\\"Bibliography_20_1\\\"]\");\n\n      if (contentParStyle) {\n        contentParStyle.parentNode.removeChild(contentParStyle);\n      }\n\n      this.checkParStyle('Index');\n      var lineHeight = \"\".concat(0.1665 * bibInfo.linespacing, \"in\");\n      var marginBottom = \"\".concat(0.1667 * bibInfo.entryspacing, \"in\");\n      var marginLeft = \"0in\",\n          textIndent = \"0in\",\n          tabStops = '<style:tab-stops/>';\n\n      if (bibInfo.hangingindent) {\n        marginLeft = \"0.5in\";\n        textIndent = \"-0.5in\";\n      } else if (bibInfo[\"second-field-align\"]) {\n        // We calculate 0.55em as roughly equivalent to one letter width.\n        var firstFieldWidth = \"\".concat((bibInfo.maxoffset + 1) * 0.55, \"em\");\n\n        if (bibInfo[\"second-field-align\"] === 'margin') {\n          textIndent = \"-\".concat(firstFieldWidth);\n          tabStops = '<style:tab-stops><style:tab-stop style:position=\"0in\"/></style:tab-stops>';\n        } else {\n          textIndent = \"-\".concat(firstFieldWidth);\n          marginLeft = \"\".concat(firstFieldWidth);\n          tabStops = \"<style:tab-stops><style:tab-stop style:position=\\\"\".concat(firstFieldWidth, \"\\\"/></style:tab-stops>\");\n        }\n      }\n\n      var styleDef = Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject9(), marginLeft, marginBottom, textIndent, lineHeight, tabStops);\n      var stylesEl = this.stylesXml.querySelector('styles');\n      stylesEl.insertAdjacentHTML('beforeEnd', styleDef);\n    }\n  }, {\n    key: \"getBulletListStyleId\",\n    value: function getBulletListStyleId() {\n      if (this.bulletListStyleId[0]) {\n        return this.bulletListStyleId;\n      }\n\n      this.bulletListStyleId[0] = ++this.listStyleCounter;\n      var autoStylesEl = this.contentXml.querySelector('automatic-styles');\n      autoStylesEl.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject10(), this.bulletListStyleId[0]));\n      var listStyleEl = autoStylesEl.lastChild; // ODT files seem to contain ten levels of lists (1-10)\n\n      for (var level = 1; level < 11; level++) {\n        listStyleEl.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject11(), level, (level + 1) * 0.25, (level + 1) * 0.25));\n      }\n\n      this.bulletListStyleId[1] = this.addListParStyle(this.bulletListStyleId[0]);\n      return this.bulletListStyleId;\n    }\n  }, {\n    key: \"getOrderedListStyleId\",\n    value: function getOrderedListStyleId() {\n      var orderedListStyleId = ++this.listStyleCounter;\n      var autoStylesEl = this.contentXml.querySelector('automatic-styles');\n      autoStylesEl.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject12(), orderedListStyleId));\n      var listStyleEl = autoStylesEl.lastChild; // ODT files seem to contain ten levels of lists (1-10)\n\n      for (var level = 1; level < 11; level++) {\n        listStyleEl.insertAdjacentHTML('beforeEnd', Object(_common__WEBPACK_IMPORTED_MODULE_0__[\"noSpaceTmp\"])(_templateObject13(), level, (level + 1) * 0.25, (level + 1) * 0.25));\n      }\n\n      return [orderedListStyleId, this.addListParStyle(orderedListStyleId)];\n    } // Add a paragraph style for either paragraph in bullet or numeric list\n\n  }, {\n    key: \"addListParStyle\",\n    value: function addListParStyle(_listId) {\n      var parStyleId = ++this.blockStyleCounter;\n      var autoStylesEl = this.contentXml.querySelector('automatic-styles');\n      autoStylesEl.insertAdjacentHTML('beforeEnd', \"<style:style style:name=\\\"P1\\\" style:family=\\\"paragraph\\\" style:parent-style-name=\\\"Standard\\\" style:list-style-name=\\\"L1\\\" />\");\n      return parStyleId;\n    }\n  }, {\n    key: \"setLanguage\",\n    value: function setLanguage(langCode) {\n      var langCodes = langCode.split('-'),\n          _langCodes = _slicedToArray(langCodes, 1),\n          language = _langCodes[0];\n\n      var _langCodes2 = _slicedToArray(langCodes, 2),\n          country = _langCodes2[1];\n\n      if (!country) {\n        country = 'none';\n      }\n\n      this.stylesXml.querySelectorAll('styles default-style text-properties').forEach(function (el) {\n        el.setAttribute('fo:language', language);\n        el.setAttribute('fo:country', country);\n      });\n    }\n  }]);\n\n  return OdtExporterStyles;\n}();\n\n//# sourceURL=webpack:///./js/modules/exporter/odt/styles.js?");

/***/ })

}]);